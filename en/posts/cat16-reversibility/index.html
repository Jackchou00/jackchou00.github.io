<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Understanding CAT16: Why Are Two Steps Needed to Ensure Reversibility? | üè°JacksBlog</title>
<meta name="keywords" content="Colour, CAM, CAT">
<meta name="description" content="Details in colour adaptation models similar to CAT16: one forward and one reverse, achieving reversibility and transference">
<meta name="author" content="">
<link rel="canonical" href="https://jackchou.top/en/posts/cat16-reversibility/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bb4e9ae2e440bccf3cb7d24276f41ff835376bf2c78193c51417a098608382c4.css" integrity="sha256-u06a4uRAvM88t9JCdvQf&#43;DU3a/LHgZPFFBegmGCDgsQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jackchou.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jackchou.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jackchou.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jackchou.top/apple-touch-icon.png">
<link rel="mask-icon" href="https://jackchou.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://jackchou.top/posts/cat16-reversibility/">
<link rel="alternate" hreflang="en" href="https://jackchou.top/en/posts/cat16-reversibility/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Noto+Sans+SC:wght@100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">


<style>
#domain-migration-notice {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 12px 20px;
  text-align: center;
  z-index: 1000;
  font-size: 14px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: none;
}

#domain-migration-notice.show {
  display: block;
}

#domain-migration-notice .notice-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
}

#domain-migration-notice .notice-text {
  flex: 1;
  text-align: center;
}

#domain-migration-notice .close-btn {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  transition: background-color 0.3s;
}

#domain-migration-notice .close-btn:hover {
  background: rgba(255,255,255,0.3);
}

#domain-migration-notice a {
  color: #ffeb3b;
  text-decoration: underline;
}

body.notice-shown {
  padding-top: 60px;
}

@media (max-width: 768px) {
  #domain-migration-notice {
    padding: 10px 15px;
    font-size: 13px;
  }
  
  #domain-migration-notice .notice-content {
    flex-direction: column;
    gap: 8px;
  }
  
  body.notice-shown {
    padding-top: 80px;
  }
}
</style>

<script>
(function() {
  
  const expiryDate = new Date('2025-10-31');
  const now = new Date();
  
  if (now > expiryDate) {
    return; 
  }
  
  
  if (localStorage.getItem('domain-migration-dismissed') === 'true') {
    return;
  }
  
  
  const noticeHTML = `
    <div id="domain-migration-notice">
      <div class="notice-content">
        <div class="notice-text">
          <span class="zh-notice" style="display: none;">
            üëã ÂÜçËßÅÔºåjackchou00.icu    üöÄ Êñ∞ÁöÑÊóÖÈÄîÔºå‰ªé <a href="https://jackchou.top">jackchou.top</a> Ëµ∑Á®ã
          </span>
          <span class="en-notice" style="display: none;">
            üëã Goodbye, jackchou00.icu    üöÄ A new chapter will begin at <a href="https://jackchou.top">jackchou.top</a>
          </span>
        </div>
        <button class="close-btn" onclick="dismissNotice()">‚úï</button>
      </div>
    </div>
  `;
  
  
  document.addEventListener('DOMContentLoaded', function() {
    
    document.body.insertAdjacentHTML('afterbegin', noticeHTML);
    
    
    const isEnglish = document.documentElement.lang === 'en' || window.location.pathname.startsWith('/en/');
    const zhNotice = document.querySelector('.zh-notice');
    const enNotice = document.querySelector('.en-notice');
    
    if (isEnglish && enNotice) {
      enNotice.style.display = 'inline';
    } else if (zhNotice) {
      zhNotice.style.display = 'inline';
    }
    
    
    const notice = document.getElementById('domain-migration-notice');
    if (notice) {
      notice.classList.add('show');
      document.body.classList.add('notice-shown');
    }
  });
  
  
  window.dismissNotice = function() {
    const notice = document.getElementById('domain-migration-notice');
    if (notice) {
      notice.style.display = 'none';
      document.body.classList.remove('notice-shown');
      localStorage.setItem('domain-migration-dismissed', 'true');
    }
  };
})();
</script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4dc1311d77d6840123f21aa2f8a31c84";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><meta property="og:url" content="https://jackchou.top/en/posts/cat16-reversibility/">
  <meta property="og:site_name" content="üè°JacksBlog">
  <meta property="og:title" content="Understanding CAT16: Why Are Two Steps Needed to Ensure Reversibility?">
  <meta property="og:description" content="Details in colour adaptation models similar to CAT16: one forward and one reverse, achieving reversibility and transference">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-07T18:00:00+08:00">
    <meta property="article:modified_time" content="2025-08-07T18:00:00+08:00">
    <meta property="article:tag" content="Colour">
    <meta property="article:tag" content="CAM">
    <meta property="article:tag" content="CAT">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Understanding CAT16: Why Are Two Steps Needed to Ensure Reversibility?">
<meta name="twitter:description" content="Details in colour adaptation models similar to CAT16: one forward and one reverse, achieving reversibility and transference">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts üå≥",
      "item": "https://jackchou.top/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Understanding CAT16: Why Are Two Steps Needed to Ensure Reversibility?",
      "item": "https://jackchou.top/en/posts/cat16-reversibility/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Understanding CAT16: Why Are Two Steps Needed to Ensure Reversibility?",
  "name": "Understanding CAT16: Why Are Two Steps Needed to Ensure Reversibility?",
  "description": "Details in colour adaptation models similar to CAT16: one forward and one reverse, achieving reversibility and transference",
  "keywords": [
    "Colour", "CAM", "CAT"
  ],
  "articleBody": "Introduction to CAT16 When two colours appear the same under two different illuminants, they are called corresponding colours. A chromatic adaptation transform (CAT) can predict the tristimulus values of a corresponding colour under one illuminant given the other illuminant and the tristimulus values of a colour under it. CAT16 is the latest chromatic adaptation transform model.\nIts basic structure is similar to the von Kries hypothesis: first convert the tristimulus values to a special cone response space, then apply independent gains to each channel in that space, and finally convert back to tristimulus values. These three steps can all be expressed by matrices.\nThe matrix that converts from tristimulus values to cone space is called $\\mathrm{M}_{16}$, and its inverse $\\mathrm{M}_{16}^{-1}$ converts from cone space back to tristimulus values. The independent channel gains are described by a diagonal matrix $\\Lambda$, that is:\n$$ \\Phi_{r,t} = \\mathrm{M}_{16}^{-1} \\cdot \\Lambda_{r,t} \\cdot \\mathrm{M}_{16} $$In use, we call the two illuminants Test and Reference. The subscripts in the equation indicate a transform from Test to Reference (r,t means from t to r). When a known colour sample is on the Test side, this is the forward transform, denoted by $\\Phi$.\nIf the known colour is on the Reference side, it is the inverse transform, denoted by $\\Psi$. For example, to predict the corresponding colour of a known Reference-side colour, use the following matrix.\n$$ \\Psi_{t,r} = \\Phi_{r,t}^{-1} = \\mathrm{M}_{16}^{-1} \\cdot \\Lambda_{r,t}^{-1} \\cdot \\mathrm{M}_{16} $$Since many symbols will follow, for clarity please first understand: ‚ÄúIn CAT16, forward and inverse transforms are not the same as swapping illuminants‚Äù:\n$$ \\Psi_{t,r} = \\Phi_{r,t}^{-1} \\ne \\Phi_{t,r} $$In this article, we ignore luminance adaptation in the model and set $Y_w=Y_{wr}$.\nWhy one-step CAT16 is not reversible Reversible means: after a forward transform from A to B, followed by another forward transform from B back to A, do we get the original values? Or, is a forward transform A to B followed by B to C equivalent to a direct forward transform A to C?\nThe one-step method does not satisfy reversibility or transitivity. The culprit is the degree of adaptation D, a factor between 0 and 1 that describes adaptation level. It can be directly specified or computed from field luminance, etc. Let‚Äôs look closely at the structure of the diagonal gain.\n$$ \\text{Gain} = D \\cdot \\frac{\\text{RGB}_{\\textit{Ref}}}{\\text{RGB}_{\\textit{Test}}} + (1 - D) $$This diagonal matrix is actually a linear combination of the identity matrix and a diagonal matrix related to the white point transform, weighted by the adaptation degree D.\nConsider a forward transform from A to B, then a forward transform from B back to A. Let $\\text{RGB}_{B}/\\text{RGB}_{A} = x$.\n$$ (Dx+(1-D))\\cdot(D\\frac{1}{x}+(1-D)) $$Multiplying these two linear combinations produces quadratic terms, so it only equals the direct transform when D is 0 or 1.\nWhy two-step CAT16 is reversible Because it consists of one forward step followed by one inverse step, with an equal-energy white as the intermediate illuminant.\n$$ \\Pi_{r,t} = \\Psi_{r,e} \\cdot \\Phi_{e,t} = \\mathrm{M}_{16}^{-1} \\cdot \\Lambda_{e,r}^{-1} \\cdot \\Lambda_{e,t} \\cdot \\mathrm{M}_{16} $$When you need transitivity or reversibility, what actually happens is ‚Äúforward then inverse, then forward then inverse,‚Äù and the two middle steps are inverses of each other.\nFor example, for A to B to C, what happens is: A forward to E, E inverse to B, B forward to E, E inverse to C. The two middle steps cancel out as inverses, which is equivalent to the two-step A to C.\n$$ \\Pi_{C,A} = \\mathrm{M}_{16}^{-1} \\cdot \\Lambda_{E,C}^{-1} \\cdot \\Lambda_{E,B} \\cdot \\Lambda_{E,B}^{-1} \\cdot \\Lambda_{E,A} \\cdot \\mathrm{M}_{16} $$Therefore, two forward steps or two inverse steps still do not yield a reversible two-step method (even with equal-energy white). You must have one forward and one inverse so the middle parts cancel during chaining.\nNote that the intermediate illuminant can be arbitrary mathematically; it does not have to be equal-energy white.\nWhy this matters The one-step CAT16 directly links the test and reference fields, but due to the adaptation degree it is neither transitive nor symmetric, so under incomplete adaptation it is ‚Äúincorrect.‚Äù The two-step version introduces an intermediate illuminant, making it mathematically transitive and reversible.\nSymmetry and transitivity are often considered desirable properties for chromatic adaptation models, though some research argues otherwise.\nThe one-step and two-step methods perform very similarly on various visual datasets. In practice, it is recommended to use the two-step CAT16 adaptation. This also matches the behavior of CIECAM16: its first step adapts the colour stimulus to an equal-energy white field, and using forward plus inverse CIECAM16 is equivalent to the two-step CAT16.\nIn practice, some applications that use CATs need transitivity and symmetry to avoid error accumulation, such as colour management systems and display pipelines.\nSome issues in the paper Li, C.; Li, Z.; Wang, Z.; Xu, Y.; Luo, M. R.; Cui, G.; Melgosa, M.; Brill, M. H.; Pointer, M. Comprehensive colour Solutions: CAM16, CAT16, and CAM16-UCS. colour Research \u0026 Application 2017, 42 (6), 703‚Äì718. https://doi.org/10.1002/col.22131.\nIn Equation (5), Y_w should be RGB_wr, otherwise it contradicts the part later stating Y_w=Y_wr=100.\nEquation (24) and Equation (23) are not equivalent. The two-step CAT16 in Equation (23) is reversible; the one in (24) is not.\nA supplementary paper discussing CAT16 mentions this issue: among the four permutations of forward/inverse in the two-step method, only two are transitive and reversible. One of those was adopted‚Äîforward first, then inverse‚Äîwhich is the Equation (23) above.\nLi, C.; Xu, Y.; Wang, Z.; Luo, M. R.; Cui, G.; Melgosa, M.; Brill, M. H.; Pointer, M. Comparing Two‚Äêstep and One‚Äêstep Chromatic Adaptation Transforms Using the CAT16 Model. colour Research \u0026 Application 2018, 43 (5), 633‚Äì642. https://doi.org/10.1002/col.22226.\nHere comes the code I previously said I would open-source some code examples I used, but as I kept writing, it turned into a draft notebook. Now I‚Äôve opened a new repository specifically for storing the code examples used in the blog. This is the first post with attached code.\nThere are two files:\ncat16_comparison.py: compares the reversibility of one-step and two-step methods. cat16_paper_implementation.py: the two-step implementation and test case from the paper‚Äôs appendix (done by Gemini) Open-source address: JacksBlog Examples: 01\n",
  "wordCount" : "1014",
  "inLanguage": "en",
  "datePublished": "2025-08-07T18:00:00+08:00",
  "dateModified": "2025-08-07T18:00:00+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jackchou.top/en/posts/cat16-reversibility/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "üè°JacksBlog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jackchou.top/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jackchou.top/en/" accesskey="h" title="üè°JacksBlog (Alt + H)">üè°JacksBlog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://jackchou.top/" title="‰∏≠Êñá"
                            aria-label="‰∏≠Êñá">Zh-Cn</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jackchou.top/en/posts/" title="Posts üå≥">
                    <span>Posts üå≥</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/photos/" title="Photos üì∑">
                    <span>Photos üì∑</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/tags/" title="Tags üè∑Ô∏è">
                    <span>Tags üè∑Ô∏è</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/about/" title="About üòº">
                    <span>About üòº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Understanding CAT16: Why Are Two Steps Needed to Ensure Reversibility?
    </h1>
    <div class="post-meta"><span title='2025-08-07 18:00:00 +0800 +0800'>2025.08.07</span>&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://jackchou.top/posts/cat16-reversibility/">Zh-Cn</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction-to-cat16" aria-label="Introduction to CAT16">Introduction to CAT16</a></li>
                <li>
                    <a href="#why-one-step-cat16-is-not-reversible" aria-label="Why one-step CAT16 is not reversible">Why one-step CAT16 is not reversible</a></li>
                <li>
                    <a href="#why-two-step-cat16-is-reversible" aria-label="Why two-step CAT16 is reversible">Why two-step CAT16 is reversible</a></li>
                <li>
                    <a href="#why-this-matters" aria-label="Why this matters">Why this matters</a></li>
                <li>
                    <a href="#some-issues-in-the-paper" aria-label="Some issues in the paper">Some issues in the paper</a></li>
                <li>
                    <a href="#here-comes-the-code" aria-label="Here comes the code">Here comes the code</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction-to-cat16">Introduction to CAT16<a hidden class="anchor" aria-hidden="true" href="#introduction-to-cat16">#</a></h2>
<p>When two colours appear the same under two different illuminants, they are called corresponding colours. A chromatic adaptation transform (CAT) can predict the tristimulus values of a corresponding colour under one illuminant given the other illuminant and the tristimulus values of a colour under it. CAT16 is the latest chromatic adaptation transform model.</p>
<p>Its basic structure is similar to the von Kries hypothesis: first convert the tristimulus values to a special cone response space, then apply independent gains to each channel in that space, and finally convert back to tristimulus values. These three steps can all be expressed by matrices.</p>
<p>The matrix that converts from tristimulus values to cone space is called $\mathrm{M}_{16}$, and its inverse $\mathrm{M}_{16}^{-1}$ converts from cone space back to tristimulus values. The independent channel gains are described by a diagonal matrix $\Lambda$, that is:</p>
$$
\Phi_{r,t} = \mathrm{M}_{16}^{-1} \cdot \Lambda_{r,t} \cdot \mathrm{M}_{16}
$$<p>In use, we call the two illuminants Test and Reference. The subscripts in the equation indicate a transform from Test to Reference (r,t means from t to r). When a known colour sample is on the Test side, this is the forward transform, denoted by $\Phi$.</p>
<p>If the known colour is on the Reference side, it is the inverse transform, denoted by $\Psi$. For example, to predict the corresponding colour of a known Reference-side colour, use the following matrix.</p>
$$
\Psi_{t,r} = \Phi_{r,t}^{-1} = \mathrm{M}_{16}^{-1} \cdot \Lambda_{r,t}^{-1} \cdot \mathrm{M}_{16}
$$<p>Since many symbols will follow, for clarity please first understand: ‚ÄúIn CAT16, forward and inverse transforms are not the same as swapping illuminants‚Äù:</p>
$$
\Psi_{t,r} = \Phi_{r,t}^{-1} \ne \Phi_{t,r}
$$<p>In this article, we ignore luminance adaptation in the model and set $Y_w=Y_{wr}$.</p>
<h2 id="why-one-step-cat16-is-not-reversible">Why one-step CAT16 is not reversible<a hidden class="anchor" aria-hidden="true" href="#why-one-step-cat16-is-not-reversible">#</a></h2>
<p>Reversible means: after a forward transform from A to B, followed by another forward transform from B back to A, do we get the original values? Or, is a forward transform A to B followed by B to C equivalent to a direct forward transform A to C?</p>
<p>The one-step method does not satisfy reversibility or transitivity. The culprit is the degree of adaptation D, a factor between 0 and 1 that describes adaptation level. It can be directly specified or computed from field luminance, etc. Let‚Äôs look closely at the structure of the diagonal gain.</p>
$$
\text{Gain} = D \cdot \frac{\text{RGB}_{\textit{Ref}}}{\text{RGB}_{\textit{Test}}} + (1 - D)
$$<p>This diagonal matrix is actually a linear combination of the identity matrix and a diagonal matrix related to the white point transform, weighted by the adaptation degree D.</p>
<p>Consider a forward transform from A to B, then a forward transform from B back to A. Let $\text{RGB}_{B}/\text{RGB}_{A} = x$.</p>
$$
(Dx+(1-D))\cdot(D\frac{1}{x}+(1-D))
$$<p>Multiplying these two linear combinations produces quadratic terms, so it only equals the direct transform when D is 0 or 1.</p>
<h2 id="why-two-step-cat16-is-reversible">Why two-step CAT16 is reversible<a hidden class="anchor" aria-hidden="true" href="#why-two-step-cat16-is-reversible">#</a></h2>
<p>Because it consists of one forward step followed by one inverse step, with an equal-energy white as the intermediate illuminant.</p>
$$
\Pi_{r,t} = \Psi_{r,e} \cdot \Phi_{e,t} = \mathrm{M}_{16}^{-1} \cdot \Lambda_{e,r}^{-1} \cdot \Lambda_{e,t} \cdot \mathrm{M}_{16}
$$<p>When you need transitivity or reversibility, what actually happens is ‚Äúforward then inverse, then forward then inverse,‚Äù and the two middle steps are inverses of each other.</p>
<p>For example, for A to B to C, what happens is: A forward to E, E inverse to B, B forward to E, E inverse to C. The two middle steps cancel out as inverses, which is equivalent to the two-step A to C.</p>
$$
\Pi_{C,A} = \mathrm{M}_{16}^{-1} \cdot \Lambda_{E,C}^{-1} \cdot \Lambda_{E,B} \cdot \Lambda_{E,B}^{-1} \cdot \Lambda_{E,A} \cdot \mathrm{M}_{16}
$$<p>Therefore, two forward steps or two inverse steps still do not yield a reversible two-step method (even with equal-energy white). You must have one forward and one inverse so the middle parts cancel during chaining.</p>
<p>Note that the intermediate illuminant can be arbitrary mathematically; it does not have to be equal-energy white.</p>
<h2 id="why-this-matters">Why this matters<a hidden class="anchor" aria-hidden="true" href="#why-this-matters">#</a></h2>
<p>The one-step CAT16 directly links the test and reference fields, but due to the adaptation degree it is neither transitive nor symmetric, so under incomplete adaptation it is ‚Äúincorrect.‚Äù The two-step version introduces an intermediate illuminant, making it mathematically transitive and reversible.</p>
<blockquote>
<p>Symmetry and transitivity are often considered desirable properties for chromatic adaptation models, though some research argues otherwise.</p>
</blockquote>
<p>The one-step and two-step methods perform very similarly on various visual datasets. In practice, it is recommended to use the two-step CAT16 adaptation. This also matches the behavior of CIECAM16: its first step adapts the colour stimulus to an equal-energy white field, and using forward plus inverse CIECAM16 is equivalent to the two-step CAT16.</p>
<p>In practice, some applications that use CATs need transitivity and symmetry to avoid error accumulation, such as colour management systems and display pipelines.</p>
<h2 id="some-issues-in-the-paper">Some issues in the paper<a hidden class="anchor" aria-hidden="true" href="#some-issues-in-the-paper">#</a></h2>
<blockquote>
<p>Li, C.; Li, Z.; Wang, Z.; Xu, Y.; Luo, M. R.; Cui, G.; Melgosa, M.; Brill, M. H.; Pointer, M. Comprehensive colour Solutions: CAM16, CAT16, and CAM16-UCS. colour Research &amp; Application 2017, 42 (6), 703‚Äì718. <a href="https://doi.org/10.1002/col.22131">https://doi.org/10.1002/col.22131</a>.</p>
</blockquote>
<p>In Equation (5), Y_w should be RGB_wr, otherwise it contradicts the part later stating Y_w=Y_wr=100.</p>
<p>Equation (24) and Equation (23) are not equivalent. The two-step CAT16 in Equation (23) is reversible; the one in (24) is not.</p>
<p>A supplementary paper discussing CAT16 mentions this issue: among the four permutations of forward/inverse in the two-step method, only two are transitive and reversible. One of those was adopted‚Äîforward first, then inverse‚Äîwhich is the Equation (23) above.</p>
<blockquote>
<p>Li, C.; Xu, Y.; Wang, Z.; Luo, M. R.; Cui, G.; Melgosa, M.; Brill, M. H.; Pointer, M. Comparing Two‚Äêstep and One‚Äêstep Chromatic Adaptation Transforms Using the CAT16 Model. colour Research &amp; Application 2018, 43 (5), 633‚Äì642. <a href="https://doi.org/10.1002/col.22226">https://doi.org/10.1002/col.22226</a>.</p>
</blockquote>
<h2 id="here-comes-the-code">Here comes the code<a hidden class="anchor" aria-hidden="true" href="#here-comes-the-code">#</a></h2>
<p>I previously said I would open-source some code examples I used, but as I kept writing, it turned into a draft notebook. Now I‚Äôve opened a new repository specifically for storing the code examples used in the blog. This is the first post with attached code.</p>
<p>There are two files:</p>
<ul>
<li><code>cat16_comparison.py</code>: compares the reversibility of one-step and two-step methods.</li>
<li><code>cat16_paper_implementation.py</code>: the two-step implementation and test case from the paper‚Äôs appendix (done by Gemini)</li>
</ul>
<p>Open-source address: <a href="https://github.com/Jackchou00/jacksblog-examples/tree/main/01%20cat16_reversibility">JacksBlog Examples: 01</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jackchou.top/en/tags/colour/">Colour</a></li>
      <li><a href="https://jackchou.top/en/tags/cam/">CAM</a></li>
      <li><a href="https://jackchou.top/en/tags/cat/">CAT</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jackchou.top/en/">üè°JacksBlog</a></span> ¬∑ 
        my friends&rsquo; websites: <a href="https://zhxwu.com/">zhxwu.com</a>, <a href="https://ylqian.com/">ylqian.com</a> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div style="text-align: center; margin-top: 10px; margin-bottom: 20px; width: 100%; display: flex; justify-content: center;">
    <img src="https://visitor-badge.laobi.icu/badge?page_id=jacksblog" alt="visitors" style="max-width: 120px; height: auto;" />
</div>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
