<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Principles of Colour Reproduction in Digital Images Notes: Illuminants and Light Sources | üè°JacksBlog</title>
<meta name="keywords" content="Colour, PCRDI">
<meta name="description" content="Notes for Principles of Colour Reproduction in Digital Images, Ep.3">
<meta name="author" content="Jack">
<link rel="canonical" href="https://jackchou.top/en/posts/pcrdi03/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.556aa244931a2b8641244b3a88ba5d10d011bee5ef6cc4a8df29bb3ab8574aa9.css" integrity="sha256-VWqiRJMaK4ZBJEs6iLpdENARvuXvbMSo3ym7OrhXSqk=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jackchou.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jackchou.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jackchou.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jackchou.top/apple-touch-icon.png">
<link rel="mask-icon" href="https://jackchou.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://jackchou.top/posts/pcrdi03/">
<link rel="alternate" hreflang="en" href="https://jackchou.top/en/posts/pcrdi03/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&family=Sen:wght@400..800&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"><meta property="og:url" content="https://jackchou.top/en/posts/pcrdi03/">
  <meta property="og:site_name" content="üè°JacksBlog">
  <meta property="og:title" content="Principles of Colour Reproduction in Digital Images Notes: Illuminants and Light Sources">
  <meta property="og:description" content="Notes for Principles of Colour Reproduction in Digital Images, Ep.3">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-01T00:00:00+08:00">
    <meta property="article:modified_time" content="2025-02-01T00:00:00+08:00">
    <meta property="article:tag" content="Colour">
    <meta property="article:tag" content="PCRDI">
      <meta property="og:image" content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp">
<meta name="twitter:title" content="Principles of Colour Reproduction in Digital Images Notes: Illuminants and Light Sources">
<meta name="twitter:description" content="Notes for Principles of Colour Reproduction in Digital Images, Ep.3">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts üå≥",
      "item": "https://jackchou.top/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Principles of Colour Reproduction in Digital Images Notes: Illuminants and Light Sources",
      "item": "https://jackchou.top/en/posts/pcrdi03/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Principles of Colour Reproduction in Digital Images Notes: Illuminants and Light Sources",
  "name": "Principles of Colour Reproduction in Digital Images Notes: Illuminants and Light Sources",
  "description": "Notes for Principles of Colour Reproduction in Digital Images, Ep.3",
  "keywords": [
    "Colour", "PCRDI"
  ],
  "articleBody": "Black Body A black body is an idealised object that absorbs all incident electromagnetic radiation, without scattering or reflection. Therefore, the electromagnetic waves radiated by a black body are determined solely by its temperature, a phenomenon known as black-body radiation.\n$$\rM_{\\lambda}(T) = \\frac{2hc^2}{\\lambda^5} \\frac{1}{e^{\\frac{hc}{\\lambda k_B T}} - 1}\r$$Here, \\(h\\) is the Planck constant, \\(c\\) is the speed of light, and \\(k_B\\) is the Boltzmann constant. Care must be taken with unit conversions during use (especially between m and nm).\nThe figure shows the spectral radiant exitance of a black body at several temperatures. Black-body radiation has the following characteristics:\nThe spectral radiant exitance curve for each temperature has only one peak. As the temperature increases, the peak of the spectral radiant exitance shifts towards shorter wavelengths. At any given wavelength, the radiant exitance of a hotter black body is always greater than that of a cooler one. The colour of a black body can be calculated from its radiant exitance within the visible spectrum. When the colours of black bodies at various temperatures are plotted on a chromaticity diagram, the resulting curve is called the Planckian locus.\nThe Planckian locus shows that as temperature increases, a black body‚Äôs colour changes from red, to yellow, passes through a white region, and then becomes blue (you can imagine this progression). In daily life, we often talk about cool and warm coloured light. According to calculations related to black-body radiation, a black body that emits cool-coloured light (bluish light) has a higher temperature, while one that emits warm-coloured light has a lower temperature.\nAlthough a black body is an idealised object and does not exist in reality, the characteristics of a heated metal are close to those of a black body (its spectral emissivity is relatively flat). To understand black-body radiation, one can imagine the process of continuously heating a piece of iron. At room temperature, iron does not glow because its radiant energy is very low. As the iron is gradually heated, according to characteristic 3, its radiant exitance increases continuously, and the iron begins to ‚Äúglow‚Äù‚Äîfirst appearing dark red, then orange-red. Subsequently, according to characteristic 2, the short-wavelength component of the spectral radiation gradually increases, causing the emitted light to become progressively bluer, appearing cool white or even blue.\nEmissivity of Metals I personally had always thought that metals were quite similar to black bodies, but in fact, there are significant differences between the two.\nAccording to Kirchhoff‚Äôs law of thermal radiation, at thermal equilibrium, a body‚Äôs absorptivity (\\(\\alpha\\)) is equal to its emissivity (\\(\\epsilon\\)). For any object, the sum of its absorptivity, reflectivity (\\(\\rho\\)), and transmissivity (\\(\\tau\\)) is 1. For metals, the transmissivity can be considered to be 0, so \\(\\rho + \\alpha = 1\\), which means \\(\\epsilon = 1 - \\rho\\).\nA black body has an emissivity of 1. Therefore, the lower a metal‚Äôs reflectivity, the closer its characteristics are to a black body. Examples include dark-coloured, rough-surfaced metals (like tungsten and iron). Additionally, the reflectivity of metals is relatively uniform across different wavelengths, which is why their radiation spectra have a shape similar to that of a black body.\nFor instance, CIE standard illuminant A is defined by the spectral distribution of a black body at a temperature of 2856 K, which is very close to the spectral distribution of a tungsten filament incandescent lamp of the same colour temperature.\nColour Temperature and Correlated Colour Temperature Light radiated by black bodies at different temperatures has different colours. Temperature can be used to describe a light source that has the same colour (same xy coordinates), which is known as its Colour Temperature.\nThe spectral power distribution of light at a certain colour temperature does not need to match that of a black body, nor does it need to have the same physical temperature; it only needs to have the same chromaticity. For most light sources, their colour coordinates do not necessarily fall on the Planckian locus. In such cases, we find the point on the Planckian locus that is closest to the light source‚Äôs colour coordinates, and this is called the Correlated Colour Temperature (CCT). ‚ÄúClosest‚Äù here refers to perceptual colour proximity, so the calculation must be performed in a uniform colour space, typically the CIE 1960 uv chromaticity diagram. Lines connecting colour coordinates with the same correlated colour temperature are called isotherms.\nIf the deviation from the Planckian locus is too great, the correlated colour temperature becomes meaningless, as two isotherms can even intersect. The degree of deviation from the Planckian locus is known as Duv (\\(\\Delta_{uv}\\)). CCT (Tcp) and Duv together can describe the colour characteristics of a light source more intuitively.\nStandard Illuminants Ultimately, colour is the human perception of light, and the light source fundamentally determines everything related to colour. Defining a light source is therefore extremely important in the study of colour science.\nIn addition to natural light sources, technological advancements have led to several revolutions in artificial light sources. For ease of communication and standardisation, the CIE has defined a number of standard illuminants. A standard illuminant is a series of spectral power distributions, not a specific light source. In fact, a light source that can produce such a spectrum may not even exist.\nCIE Standard Illuminant D Some standard illuminants are derived from natural light sources, the most important of which is daylight. By collecting multiple sets of spectral data from daylight, the CIE proposed a method to calculate the spectrum of daylight based on its colour temperature. The resulting spectral distribution is known as a CIE daylight illuminant. The daylight illuminant with a correlated colour temperature of 6504 K is defined as the D65 standard illuminant. Additionally, D50, D55, and D75, with correlated colour temperatures of 5003 K, 5500 K, and 7504 K respectively, serve as supplementary illuminants. Currently, there is no light source that can directly produce the D65 spectrum.\nThe specific calculation process is as follows:\nGiven a correlated colour temperature \\(T_{cp}\\), calculate the corresponding \\(x_D\\). The following formula for \\(T_{cp}\\) is applicable in the range of 4000 K to 7000 K. $$\rx_D = -4.6070 \\times 10^9 / T_{cp}^3 + 2.9678 \\times 10^6 / T_{cp}^2 + 0.09911 / T_{cp} + 0.244063\r$$ Calculate \\(y_D\\). The formula below is actually a second-order polynomial fit of the daylight locus. \\(x_D\\) and \\(y_D\\) are the colour coordinates of the daylight illuminant corresponding to \\(T_{cp}\\). $$\ry_D = -3.000 x_D^2 + 2.870 x_D - 0.275\r$$ The CIE used statistical methods to perform a principal component analysis on the collected daylight spectral data, dividing the daylight spectrum into three parts. \\(M_1\\) and \\(M_2\\) are calculated from \\(x_D\\) and \\(y_D\\). $$\rS_D(\\lambda) = S_0(\\lambda) + M_1 S_1(\\lambda) +M_2 S_2(\\lambda)\r$$$$\rM_1 = \\frac{-1.3515 - 1.7703 x_D + 5.9114 y_D}{0.0241 + 0.2562 x_D - 0.7341 y_D}\r$$$$\rM_2 = \\frac{0.0300 - 31.4424 x_D + 30.0717 y_D}{0.0241 + 0.2562 x_D - 0.7341 y_D}\r$$The resulting \\(S_D(\\lambda)\\) is the spectral power distribution of the CIE daylight illuminant, which is a function of the correlated colour temperature \\(T_{cp}\\).\nD. B. Judd et al., ‚ÄòSpectral Distribution of Typical Daylight as a Function of Correlated Color Temperature‚Äô, J. Opt. Soc. Am., vol. 54, no. 8, p. 1031, Aug. 1964, doi: 10.1364/JOSA.54.001031.\nCIE Standard Illuminant A Illuminant A represents the light emitted by an incandescent lamp; its spectral power distribution is that of a black-body radiator at a temperature of 2856 K. The CIE specifies a tungsten filament incandescent lamp with a colour temperature of 2856 K as standard illuminant A.\nCIE Standard Illuminant E Equal-energy white light is an artificially defined spectral distribution. It is widely used in theoretical calculations for colour spaces, where it serves as a neutral reference. There is no light source that can produce illuminant E.\nOther Standard Illuminants Standard illuminants B and C, which simulated daylight, have been deprecated.\nBesides incandescent lamps, fluorescent lamps were also a primary lighting device for a considerable period, especially in the United States and Europe. The standard illuminant FL series represents the spectral distributions of fluorescent lamps, with FL1 to FL12 corresponding to different types of fluorescent lamps.\nFL2, also known as CWF (Cool White Fluorescent), is mainly used in shopping centres and offices in the United States. It has a correlated colour temperature of 4150 K (so its colour temperature is not particularly cool).\nFL11, also known as TL84, is a proprietary product of Philips and is the most important commercial light source in Europe. It has a correlated colour temperature of 4000 K.\nAlthough fluorescent lamps are now being gradually replaced by LEDs, the standard illuminants for fluorescent lamps are still used in quality control and colour matching booths for their respective markets. Due to their emission mechanism, fluorescent lamps have narrow-band spectra, giving them an important role in the study of metamerism.\nColour Rendering Most objects do not emit light themselves but become visible when illuminated by a light source. Therefore, the light source directly affects the colour of an object as perceived by the human eye. The effect of a light source on colour is known as Colour Rendering. The colour rendering properties of a light source are a crucial metric for its evaluation and can be broadly divided into colour fidelity indices and gamut indices.\nColour Fidelity Index The colour of an object under a given light source should be consistent with its colour under a ‚Äúfamiliar‚Äù reference illuminant, which is typically daylight or a standard illuminant from the D series. Therefore, the smaller the colour difference between its appearance under the test source and the reference illuminant, the higher the colour fidelity of the test source.\nSimply put, the method for testing colour fidelity is as follows: select a reference illuminant and a series of colour samples (with known reflectance). Calculate the tristimulus values of the colour samples based on the light source‚Äôs spectrum and the samples‚Äô reflectance. Then, choose a uniform colour space and a colour difference formula to calculate the colour difference of a sample under the two light sources.\nFurthermore, even if the reference illuminant and the test light source have the same correlated colour temperature, their colours may still differ. Therefore, a chromatic adaptation model is needed to correct for the influence of the difference in the light sources‚Äô own colours.\nThe Colour Rendering Index (CRI) is a method specified by the CIE for evaluating the colour rendering of light sources. For sources with a CCT of 5000 K and above, a D series standard illuminant of the same CCT is used as the reference. Below 5000 K, black-body radiation is used. There are 14 colour samples. The chromatic adaptation method used is the Von Kries transformation model, and the uniform colour space and colour difference formula are from CIE 1964.\nWhen evaluating some narrow-band light sources, the CRI correlates poorly with actual visual perception. CRI2012 was an improvement on this. Light source manufacturers can increase their CRI values by specifically tailoring the spectral shape, but the source may not actually render other colours well. CRI2012 switched to using 17 mathematically generated, centrally symmetric reflectance samples to avoid this ‚Äúcheating‚Äù problem. Additionally, the uniform colour space and colour difference formula were replaced with CIECAM02-UCS, and the method for calculating the average colour difference was changed from an arithmetic mean to a root mean square (RMS) average.\nBecause the reference illuminant used has the same correlated colour temperature as the light source being tested, the CCT itself does not affect the colour rendering evaluation.\nGamut Index A light source can also have the effect of making an object‚Äôs colours appear more vibrant and vivid, which can improve the subjective evaluation of the object‚Äôs colour. Therefore, the gamut index is also an important metric for evaluating light sources.\nSome evaluation systems have introduced assessments of the gamut index and other more specific metrics, such as the Colour Quality Scale (CQS) from the National Institute of Standards and Technology (NIST) in the US, and TM-30-15 from the Illuminating Engineering Society (IES). These introduce evaluations for metrics like gamut, hue fidelity, and skin tone fidelity.\nColour Rendering in Practice How should we understand colour rendering? Consider whether the spectrum is ‚Äúcomplete‚Äù. If a spectrum has no power distribution at all within a certain wavelength range, then an object whose reflectance peaks within that range cannot be illuminated by this light source. LEDs generally have lower energy distribution at long wavelengths, and the ninth colour sample in the CRI (R9) is a relatively saturated red. Consequently, the R9 value for LEDs is typically low.\nThe white point of a display is typically D65. This white is created by mixing the three red, green, and blue primaries. The spectral distributions of display primaries are relatively narrow, so if the white displayed on a screen were used as a light source, its colour rendering would also be poor.\nSome sellers of lighting fixtures advertise their lights as having high colour rendering or being ‚Äúfull-spectrum‚Äù. In the CRI system, the general colour rendering index, Ra, is the average of the first eight test colour samples and does not include R9, which is a weak point for LEDs. As a result, the nominal colour rendering index for LED fixtures is often very high, reaching 90 or even over 95.\nFrom 2024, China no longer permits the use of ‚Äúpork lamps‚Äù in the market. These lamps use a special spectrum that makes pork underneath them look fresher. They can be seen as lights specifically optimised for the ‚Äúpork colour sample,‚Äù and their colour rendering index for other colours is very low.\nColour Rendering Index (CRI Ra) and Correlated Colour Temperature (CCT) of common light sources:\nHigh-pressure sodium lamp: 24, 2100 K FL2 / CWF: 62, 4150 K FL11 / TL84: 85, 4000 K Full-spectrum LED (blue/violet-pumped): 95-99, 2700-5000 K Incandescent lamp: 100, 2856 K Regarding incandescent lamps, their very low colour temperature and extremely low luminous efficacy make them unsuitable for general lighting. There are quite a few ‚Äúincandescent lamp cults‚Äù online, but this attitude actually demonstrates a fundamental misunderstanding of colour rendering.\nLight Source Consistency The Colour Rendering Index is a human-centric evaluation metric; it assesses the colour performance of samples under different light sources as perceived by the human eye. For film and television production, however, it is the camera, not the human eye, that samples and records the light. Therefore, using the CRI to evaluate lighting in film and television is not appropriate (although many companies selling film and TV lighting fixtures still use CRI for evaluation).\nThe TLCI (Television Lighting Consistency Index) and TLMF (Television Luminaire Matching Factor) proposed by the European Broadcasting Union are methods specifically designed to evaluate the colour rendering performance of light sources in television production. Similar to the CRI, they also require the selection of a reference light source, etc., but the tristimulus values used for comparing colour differences are replaced with the tristimulus values captured by a camera, processed, and then displayed on a screen, rather than those calculated directly from the colour samples‚Äô reflectance.\nThe colour samples used are the 18 (excluding greyscale) or 24 colours from a ColorChecker¬Æ. This is a widely used set of colour samples in film and television production and is the de facto industry standard.\nThe TLCI evaluates the consistency between a single light source and a standard illuminant (the reference illuminant). The TLMF evaluates the consistency between a mixture of light sources and another actual light source (the reference illuminant).\nThought Exercise What is the difference between an illuminant and a light source?\nAnswer\r- An illuminant refers to a specific spectral distribution, which may not exist in reality, such as the standard illuminant D series and E.\r- A light source is a physical object that emits light, which actually exists, such as incandescent lamps, fluorescent lamps, and LED lamps.\r- Some standard illuminants have corresponding light sources, for example, standard illuminant A corresponds to an incandescent lamp.\r",
  "wordCount" : "2660",
  "inLanguage": "en",
  "image": "https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp","datePublished": "2025-02-01T00:00:00+08:00",
  "dateModified": "2025-02-01T00:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "Jack"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jackchou.top/en/posts/pcrdi03/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "üè°JacksBlog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jackchou.top/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jackchou.top/en/" accesskey="h" title="üè°JacksBlog (Alt + H)">üè°JacksBlog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://jackchou.top/" title="‰∏≠Êñá"
                            aria-label="‰∏≠Êñá">‰∏≠Êñá</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jackchou.top/en/posts/" title="Posts üå≥">
                    <span>Posts üå≥</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/photos/" title="Photos üì∑">
                    <span>Photos üì∑</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/tags/" title="Tags üè∑Ô∏è">
                    <span>Tags üè∑Ô∏è</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/about/" title="About üòº">
                    <span>About üòº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Principles of Colour Reproduction in Digital Images Notes: Illuminants and Light Sources
    </h1>
    <div class="post-meta"><span title='2025-02-01 00:00:00 +0800 +0800'>2025.02.01</span>&nbsp;¬∑&nbsp;Jack&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://jackchou.top/posts/pcrdi03/">‰∏≠Êñá</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#black-body" aria-label="Black Body">Black Body</a><ul>
                        
                <li>
                    <a href="#emissivity-of-metals" aria-label="Emissivity of Metals">Emissivity of Metals</a></li></ul>
                </li>
                <li>
                    <a href="#colour-temperature-and-correlated-colour-temperature" aria-label="Colour Temperature and Correlated Colour Temperature">Colour Temperature and Correlated Colour Temperature</a></li>
                <li>
                    <a href="#standard-illuminants" aria-label="Standard Illuminants">Standard Illuminants</a><ul>
                        
                <li>
                    <a href="#cie-standard-illuminant-d" aria-label="CIE Standard Illuminant D">CIE Standard Illuminant D</a></li>
                <li>
                    <a href="#cie-standard-illuminant-a" aria-label="CIE Standard Illuminant A">CIE Standard Illuminant A</a></li>
                <li>
                    <a href="#cie-standard-illuminant-e" aria-label="CIE Standard Illuminant E">CIE Standard Illuminant E</a></li>
                <li>
                    <a href="#other-standard-illuminants" aria-label="Other Standard Illuminants">Other Standard Illuminants</a></li></ul>
                </li>
                <li>
                    <a href="#colour-rendering" aria-label="Colour Rendering">Colour Rendering</a><ul>
                        
                <li>
                    <a href="#colour-fidelity-index" aria-label="Colour Fidelity Index">Colour Fidelity Index</a></li>
                <li>
                    <a href="#gamut-index" aria-label="Gamut Index">Gamut Index</a></li>
                <li>
                    <a href="#colour-rendering-in-practice" aria-label="Colour Rendering in Practice">Colour Rendering in Practice</a></li></ul>
                </li>
                <li>
                    <a href="#light-source-consistency" aria-label="Light Source Consistency">Light Source Consistency</a></li>
                <li>
                    <a href="#thought-exercise" aria-label="Thought Exercise">Thought Exercise</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="black-body">Black Body<a hidden class="anchor" aria-hidden="true" href="#black-body">#</a></h2>
<p>A black body is an idealised object that absorbs all incident electromagnetic radiation, without scattering or reflection. Therefore, the electromagnetic waves radiated by a black body are determined solely by its temperature, a phenomenon known as black-body radiation.</p>
$$
    M_{\lambda}(T) = \frac{2hc^2}{\lambda^5} \frac{1}{e^{\frac{hc}{\lambda k_B T}} - 1}
$$<p>Here, \(h\) is the Planck constant, \(c\) is the speed of light, and \(k_B\) is the Boltzmann constant. Care must be taken with unit conversions during use (especially between m and nm).</p>
<p><img alt="Spectral power distribution of black-body radiation" loading="lazy" src="https://img.jackchou.top/jack-img/2025/02/8df84bbc877b489fb1939e3c9f23a3a9.svg"></p>
<p>The figure shows the spectral radiant exitance of a black body at several temperatures. Black-body radiation has the following characteristics:</p>
<ol>
<li>The spectral radiant exitance curve for each temperature has only one peak.</li>
<li>As the temperature increases, the peak of the spectral radiant exitance shifts towards shorter wavelengths.</li>
<li>At any given wavelength, the radiant exitance of a hotter black body is always greater than that of a cooler one.</li>
</ol>
<p>The colour of a black body can be calculated from its radiant exitance within the visible spectrum. When the colours of black bodies at various temperatures are plotted on a chromaticity diagram, the resulting curve is called the Planckian locus.</p>
<p><img alt="The Planckian locus on the CIE 1931 xy chromaticity diagram" loading="lazy" src="https://img.jackchou.top/jack-img/2025/02/0d6bef2fdf14c740bd22d4ff8c09bc4a.svg"></p>
<p>The Planckian locus shows that as temperature increases, a black body&rsquo;s colour changes from red, to yellow, passes through a white region, and then becomes blue (you can imagine this progression). In daily life, we often talk about cool and warm coloured light. According to calculations related to black-body radiation, a black body that emits cool-coloured light (bluish light) has a higher temperature, while one that emits warm-coloured light has a lower temperature.</p>
<p>Although a black body is an idealised object and does not exist in reality, the characteristics of a heated metal are close to those of a black body (its spectral emissivity is relatively flat). To understand black-body radiation, one can imagine the process of continuously heating a piece of iron. At room temperature, iron does not glow because its radiant energy is very low. As the iron is gradually heated, according to characteristic 3, its radiant exitance increases continuously, and the iron begins to &ldquo;glow&rdquo;‚Äîfirst appearing dark red, then orange-red. Subsequently, according to characteristic 2, the short-wavelength component of the spectral radiation gradually increases, causing the emitted light to become progressively bluer, appearing cool white or even blue.</p>
<h3 id="emissivity-of-metals">Emissivity of Metals<a hidden class="anchor" aria-hidden="true" href="#emissivity-of-metals">#</a></h3>
<p>I personally had always thought that metals were quite similar to black bodies, but in fact, there are significant differences between the two.</p>
<p>According to Kirchhoff&rsquo;s law of thermal radiation, at thermal equilibrium, a body&rsquo;s absorptivity (\(\alpha\)) is equal to its emissivity (\(\epsilon\)). For any object, the sum of its absorptivity, reflectivity (\(\rho\)), and transmissivity (\(\tau\)) is 1. For metals, the transmissivity can be considered to be 0, so \(\rho + \alpha = 1\), which means \(\epsilon = 1 - \rho\).</p>
<p>A black body has an emissivity of 1. Therefore, the lower a metal&rsquo;s reflectivity, the closer its characteristics are to a black body. Examples include dark-coloured, rough-surfaced metals (like tungsten and iron). Additionally, the reflectivity of metals is relatively uniform across different wavelengths, which is why their radiation spectra have a shape similar to that of a black body.</p>
<p>For instance, CIE standard illuminant A is defined by the spectral distribution of a black body at a temperature of 2856 K, which is very close to the spectral distribution of a tungsten filament incandescent lamp of the same colour temperature.</p>
<h2 id="colour-temperature-and-correlated-colour-temperature">Colour Temperature and Correlated Colour Temperature<a hidden class="anchor" aria-hidden="true" href="#colour-temperature-and-correlated-colour-temperature">#</a></h2>
<p>Light radiated by black bodies at different temperatures has different colours. Temperature can be used to describe a light source that has the same colour (same xy coordinates), which is known as its Colour Temperature.</p>
<p>The spectral power distribution of light at a certain colour temperature does not need to match that of a black body, nor does it need to have the same physical temperature; it only needs to have the same chromaticity. For most light sources, their colour coordinates do not necessarily fall on the Planckian locus. In such cases, we find the point on the Planckian locus that is closest to the light source&rsquo;s colour coordinates, and this is called the Correlated Colour Temperature (CCT). &ldquo;Closest&rdquo; here refers to perceptual colour proximity, so the calculation must be performed in a uniform colour space, typically the CIE 1960 uv chromaticity diagram. Lines connecting colour coordinates with the same correlated colour temperature are called isotherms.</p>
<p><img alt="Correlated colour temperature lines on the 1960 UCS diagram" loading="lazy" src="https://img.jackchou.top/jack-img/2025/02/c19d5605d40039c0937c0e0f563e1fb3.svg"></p>
<p>If the deviation from the Planckian locus is too great, the correlated colour temperature becomes meaningless, as two isotherms can even intersect. The degree of deviation from the Planckian locus is known as Duv (\(\Delta_{uv}\)). CCT (Tcp) and Duv together can describe the colour characteristics of a light source more intuitively.</p>
<h2 id="standard-illuminants">Standard Illuminants<a hidden class="anchor" aria-hidden="true" href="#standard-illuminants">#</a></h2>
<p>Ultimately, colour is the human perception of light, and the light source fundamentally determines everything related to colour. Defining a light source is therefore extremely important in the study of colour science.</p>
<p>In addition to natural light sources, technological advancements have led to several revolutions in artificial light sources. For ease of communication and standardisation, the CIE has defined a number of standard illuminants. A standard illuminant is a series of <strong>spectral power distributions</strong>, not a specific light source. In fact, a light source that can produce such a spectrum may not even exist.</p>
<h3 id="cie-standard-illuminant-d">CIE Standard Illuminant D<a hidden class="anchor" aria-hidden="true" href="#cie-standard-illuminant-d">#</a></h3>
<p>Some standard illuminants are derived from natural light sources, the most important of which is daylight. By collecting multiple sets of spectral data from daylight, the CIE proposed a method to calculate the spectrum of daylight based on its colour temperature. The resulting spectral distribution is known as a CIE daylight illuminant. The daylight illuminant with a correlated colour temperature of 6504 K is defined as the D65 standard illuminant. Additionally, D50, D55, and D75, with correlated colour temperatures of 5003 K, 5500 K, and 7504 K respectively, serve as supplementary illuminants. <strong>Currently, there is no light source that can directly produce the D65 spectrum.</strong></p>
<p>The specific calculation process is as follows:</p>
<ol>
<li>Given a correlated colour temperature \(T_{cp}\), calculate the corresponding \(x_D\). The following formula for \(T_{cp}\) is applicable in the range of 4000 K to 7000 K.</li>
</ol>
$$
    x_D = -4.6070 \times 10^9 / T_{cp}^3 + 2.9678 \times 10^6 / T_{cp}^2 + 0.09911 / T_{cp} + 0.244063
$$<ol start="2">
<li>Calculate \(y_D\). The formula below is actually a second-order polynomial fit of the daylight locus. \(x_D\) and \(y_D\) are the colour coordinates of the daylight illuminant corresponding to \(T_{cp}\).</li>
</ol>
$$
    y_D = -3.000 x_D^2 + 2.870 x_D - 0.275
$$<ol start="3">
<li>The CIE used statistical methods to perform a principal component analysis on the collected daylight spectral data, dividing the daylight spectrum into three parts. \(M_1\) and \(M_2\) are calculated from \(x_D\) and \(y_D\).</li>
</ol>
<p><img alt="Spectral components of daylight" loading="lazy" src="https://img.jackchou.top/jack-img/2025/02/c52bd81d19ea9509825322e2282170e2.svg"></p>
$$
    S_D(\lambda) = S_0(\lambda) + M_1 S_1(\lambda) +M_2 S_2(\lambda)
$$$$
    M_1 = \frac{-1.3515 - 1.7703 x_D + 5.9114 y_D}{0.0241 + 0.2562 x_D - 0.7341 y_D}
$$$$
    M_2 = \frac{0.0300 - 31.4424 x_D + 30.0717 y_D}{0.0241 + 0.2562 x_D - 0.7341 y_D}
$$<p>The resulting \(S_D(\lambda)\) is the spectral power distribution of the CIE daylight illuminant, which is a function of the correlated colour temperature \(T_{cp}\).</p>
<blockquote>
<p>D. B. Judd et al., ‚ÄòSpectral Distribution of Typical Daylight as a Function of Correlated Color Temperature‚Äô, J. Opt. Soc. Am., vol. 54, no. 8, p. 1031, Aug. 1964, doi: 10.1364/JOSA.54.001031.</p>
</blockquote>
<h3 id="cie-standard-illuminant-a">CIE Standard Illuminant A<a hidden class="anchor" aria-hidden="true" href="#cie-standard-illuminant-a">#</a></h3>
<p>Illuminant A represents the light emitted by an incandescent lamp; its spectral power distribution is that of a black-body radiator at a temperature of 2856 K. The CIE specifies a tungsten filament incandescent lamp with a colour temperature of 2856 K as standard illuminant A.</p>
<h3 id="cie-standard-illuminant-e">CIE Standard Illuminant E<a hidden class="anchor" aria-hidden="true" href="#cie-standard-illuminant-e">#</a></h3>
<p>Equal-energy white light is an artificially defined spectral distribution. It is widely used in theoretical calculations for colour spaces, where it serves as a neutral reference. There is no light source that can produce illuminant E.</p>
<h3 id="other-standard-illuminants">Other Standard Illuminants<a hidden class="anchor" aria-hidden="true" href="#other-standard-illuminants">#</a></h3>
<p>Standard illuminants B and C, which simulated daylight, have been deprecated.</p>
<p>Besides incandescent lamps, fluorescent lamps were also a primary lighting device for a considerable period, especially in the United States and Europe. The standard illuminant FL series represents the spectral distributions of fluorescent lamps, with FL1 to FL12 corresponding to different types of fluorescent lamps.</p>
<p>FL2, also known as CWF (Cool White Fluorescent), is mainly used in shopping centres and offices in the United States. It has a correlated colour temperature of 4150 K (so its colour temperature is not particularly cool).</p>
<p>FL11, also known as TL84, is a proprietary product of Philips and is the most important commercial light source in Europe. It has a correlated colour temperature of 4000 K.</p>
<p>Although fluorescent lamps are now being gradually replaced by LEDs, the standard illuminants for fluorescent lamps are still used in quality control and colour matching booths for their respective markets. Due to their emission mechanism, fluorescent lamps have narrow-band spectra, giving them an important role in the study of metamerism.</p>
<p><img alt="Spectra of TL84, A, and D65 standard illuminants" loading="lazy" src="https://img.jackchou.top/jack-img/2025/02/31a2bde8b7b4ea0936c83e1d6995ce31.svg"></p>
<h2 id="colour-rendering">Colour Rendering<a hidden class="anchor" aria-hidden="true" href="#colour-rendering">#</a></h2>
<p>Most objects do not emit light themselves but become visible when illuminated by a light source. Therefore, the light source directly affects the colour of an object as perceived by the human eye. The effect of a light source on colour is known as Colour Rendering. The colour rendering properties of a light source are a crucial metric for its evaluation and can be broadly divided into colour fidelity indices and gamut indices.</p>
<h3 id="colour-fidelity-index">Colour Fidelity Index<a hidden class="anchor" aria-hidden="true" href="#colour-fidelity-index">#</a></h3>
<p>The colour of an object under a given light source should be consistent with its colour under a &ldquo;familiar&rdquo; reference illuminant, which is typically daylight or a standard illuminant from the D series. Therefore, the smaller the colour difference between its appearance under the test source and the reference illuminant, the higher the colour fidelity of the test source.</p>
<p>Simply put, the method for testing colour fidelity is as follows: select a reference illuminant and a series of colour samples (with known reflectance). Calculate the tristimulus values of the colour samples based on the light source&rsquo;s spectrum and the samples&rsquo; reflectance. Then, choose a uniform colour space and a colour difference formula to calculate the colour difference of a sample under the two light sources.</p>
<p>Furthermore, even if the reference illuminant and the test light source have the same correlated colour temperature, their colours may still differ. Therefore, a chromatic adaptation model is needed to correct for the influence of the difference in the light sources&rsquo; own colours.</p>
<p>The Colour Rendering Index (CRI) is a method specified by the CIE for evaluating the colour rendering of light sources. For sources with a CCT of 5000 K and above, a D series standard illuminant of the same CCT is used as the reference. Below 5000 K, black-body radiation is used. There are 14 colour samples. The chromatic adaptation method used is the Von Kries transformation model, and the uniform colour space and colour difference formula are from CIE 1964.</p>
<p>When evaluating some narrow-band light sources, the CRI correlates poorly with actual visual perception. CRI2012 was an improvement on this. Light source manufacturers can increase their CRI values by specifically tailoring the spectral shape, but the source may not actually render other colours well. CRI2012 switched to using 17 mathematically generated, centrally symmetric reflectance samples to avoid this &ldquo;cheating&rdquo; problem. Additionally, the uniform colour space and colour difference formula were replaced with CIECAM02-UCS, and the method for calculating the average colour difference was changed from an arithmetic mean to a root mean square (RMS) average.</p>
<p>Because the reference illuminant used has the same correlated colour temperature as the light source being tested, the CCT itself does not affect the colour rendering evaluation.</p>
<h3 id="gamut-index">Gamut Index<a hidden class="anchor" aria-hidden="true" href="#gamut-index">#</a></h3>
<p>A light source can also have the effect of making an object&rsquo;s colours appear more vibrant and vivid, which can improve the subjective evaluation of the object&rsquo;s colour. Therefore, the gamut index is also an important metric for evaluating light sources.</p>
<p>Some evaluation systems have introduced assessments of the gamut index and other more specific metrics, such as the Colour Quality Scale (CQS) from the National Institute of Standards and Technology (NIST) in the US, and TM-30-15 from the Illuminating Engineering Society (IES). These introduce evaluations for metrics like gamut, hue fidelity, and skin tone fidelity.</p>
<h3 id="colour-rendering-in-practice">Colour Rendering in Practice<a hidden class="anchor" aria-hidden="true" href="#colour-rendering-in-practice">#</a></h3>
<p>How should we understand colour rendering? Consider whether the spectrum is &ldquo;complete&rdquo;. If a spectrum has no power distribution at all within a certain wavelength range, then an object whose reflectance peaks within that range cannot be illuminated by this light source. LEDs generally have lower energy distribution at long wavelengths, and the ninth colour sample in the CRI (R9) is a relatively saturated red. Consequently, the R9 value for LEDs is typically low.</p>
<p>The white point of a display is typically D65. This white is created by mixing the three red, green, and blue primaries. The spectral distributions of display primaries are relatively narrow, so if the white displayed on a screen were used as a light source, its colour rendering would also be poor.</p>
<p>Some sellers of lighting fixtures advertise their lights as having high colour rendering or being &ldquo;full-spectrum&rdquo;. In the CRI system, the general colour rendering index, Ra, is the average of the first eight test colour samples and does not include R9, which is a weak point for LEDs. As a result, the nominal colour rendering index for LED fixtures is often very high, reaching 90 or even over 95.</p>
<p>From 2024, China no longer permits the use of &ldquo;pork lamps&rdquo; in the market. These lamps use a special spectrum that makes pork underneath them look fresher. They can be seen as lights specifically optimised for the &ldquo;pork colour sample,&rdquo; and their colour rendering index for other colours is very low.</p>
<p>Colour Rendering Index (CRI Ra) and Correlated Colour Temperature (CCT) of common light sources:</p>
<ul>
<li>High-pressure sodium lamp: 24, 2100 K</li>
<li>FL2 / CWF: 62, 4150 K</li>
<li>FL11 / TL84: 85, 4000 K</li>
<li>Full-spectrum LED (blue/violet-pumped): 95-99, 2700-5000 K</li>
<li>Incandescent lamp: 100, 2856 K</li>
</ul>
<p>Regarding incandescent lamps, their very low colour temperature and extremely low luminous efficacy make them unsuitable for general lighting. There are quite a few &ldquo;incandescent lamp cults&rdquo; online, but this attitude actually demonstrates a fundamental misunderstanding of colour rendering.</p>
<h2 id="light-source-consistency">Light Source Consistency<a hidden class="anchor" aria-hidden="true" href="#light-source-consistency">#</a></h2>
<p>The Colour Rendering Index is a human-centric evaluation metric; it assesses the colour performance of samples under different light sources as perceived by the human eye. For film and television production, however, it is the camera, not the human eye, that samples and records the light. Therefore, using the CRI to evaluate lighting in film and television is not appropriate (although many companies selling film and TV lighting fixtures still use CRI for evaluation).</p>
<p>The TLCI (Television Lighting Consistency Index) and TLMF (Television Luminaire Matching Factor) proposed by the European Broadcasting Union are methods specifically designed to evaluate the colour rendering performance of light sources in television production. Similar to the CRI, they also require the selection of a reference light source, etc., but the tristimulus values used for comparing colour differences are replaced with the tristimulus values captured by a camera, processed, and then displayed on a screen, rather than those calculated directly from the colour samples&rsquo; reflectance.</p>
<p>The colour samples used are the 18 (excluding greyscale) or 24 colours from a ColorChecker¬Æ. This is a widely used set of colour samples in film and television production and is the de facto industry standard.</p>
<p>The TLCI evaluates the consistency between a single light source and a standard illuminant (the reference illuminant). The TLMF evaluates the consistency between a mixture of light sources and another actual light source (the reference illuminant).</p>
<h2 id="thought-exercise">Thought Exercise<a hidden class="anchor" aria-hidden="true" href="#thought-exercise">#</a></h2>
<p>What is the difference between an illuminant and a light source?</p>
<div class="toggle-wrapper">
    <button class="toggle-button" onclick="this.nextElementSibling.classList.toggle('collapsed');">
      Answer
    </button>
    <div class="toggle-content collapsed">
      
- An illuminant refers to a specific spectral distribution, which may not exist in reality, such as the standard illuminant D series and E.

- A light source is a physical object that emits light, which actually exists, such as incandescent lamps, fluorescent lamps, and LED lamps.

- Some standard illuminants have corresponding light sources, for example, standard illuminant A corresponds to an incandescent lamp.

    </div>
  </div>
  
  <style>
  .toggle-wrapper {
    margin: 1em 0;
  }
  
  .toggle-button {
    background:#6486d6;
    border: none;
    padding: 0.5em 1em;
    cursor: pointer;
    border-radius: 4px;
    font-size: 1em;
  }
  
  .toggle-content {
    overflow: hidden;
    height: 0;
  }
  
  .toggle-content.collapsed {
    height: 0;
    padding: 0;
  }
  
  .toggle-content:not(.collapsed) {
    height: auto;
    padding: 1em;
    border-radius: 4px;
  }
  
  </style>
  


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jackchou.top/en/tags/colour/">Colour</a></li>
      <li><a href="https://jackchou.top/en/tags/pcrdi/">PCRDI</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jackchou.top/en/">üè°JacksBlog</a></span> ¬∑ 
        my friends&rsquo; websites: <a href="https://zhxwu.com/">zhxwu.com</a>, <a href="https://ylqian.com/">ylqian.com</a> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div style="text-align: center; margin-top: 10px; margin-bottom: 20px; width: 100%; display: flex; justify-content: center;">
    <img src="https://visitor-badge.laobi.icu/badge?page_id=jacksblog" alt="visitors" style="max-width: 120px; height: auto;" />
</div>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
