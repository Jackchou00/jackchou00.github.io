<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Reflectance: A Second Path to Readability in Bright Environments | üè°JacksBlog</title>
<meta name="keywords" content="Colour, Display">
<meta name="description" content="Potentially a more effective improvement than class-leading screen brightness and aggressive tuning algorithms.">
<meta name="author" content="">
<link rel="canonical" href="https://jackchou00.icu/en/posts/display-reflectance/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7661776b18b3ce31a740dd6e5be11f84f6e3f987238493cf541cd274acdb2612.css" integrity="sha256-dmF3axizzjGnQN1uW&#43;EfhPbj&#43;YcjhJPPVBzSdKzbJhI=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jackchou00.icu/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jackchou00.icu/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jackchou00.icu/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jackchou00.icu/apple-touch-icon.png">
<link rel="mask-icon" href="https://jackchou00.icu/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://jackchou00.icu/posts/display-reflectance/">
<link rel="alternate" hreflang="en" href="https://jackchou00.icu/en/posts/display-reflectance/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Noto+Sans+SC:wght@100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"><meta property="og:url" content="https://jackchou00.icu/en/posts/display-reflectance/">
  <meta property="og:site_name" content="üè°JacksBlog">
  <meta property="og:title" content="Reflectance: A Second Path to Readability in Bright Environments">
  <meta property="og:description" content="Potentially a more effective improvement than class-leading screen brightness and aggressive tuning algorithms.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-14T16:00:00+08:00">
    <meta property="article:modified_time" content="2025-03-14T16:00:00+08:00">
    <meta property="article:tag" content="Colour">
    <meta property="article:tag" content="Display">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reflectance: A Second Path to Readability in Bright Environments">
<meta name="twitter:description" content="Potentially a more effective improvement than class-leading screen brightness and aggressive tuning algorithms.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts üå≥",
      "item": "https://jackchou00.icu/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Reflectance: A Second Path to Readability in Bright Environments",
      "item": "https://jackchou00.icu/en/posts/display-reflectance/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Reflectance: A Second Path to Readability in Bright Environments",
  "name": "Reflectance: A Second Path to Readability in Bright Environments",
  "description": "Potentially a more effective improvement than class-leading screen brightness and aggressive tuning algorithms.",
  "keywords": [
    "Colour", "Display"
  ],
  "articleBody": "Brighter, and Brighter Still If I recall correctly, from the Realme GT 5 Pro onwards, the peak brightness of mobile phone screens has become increasingly ‚Äúexaggerated‚Äù.\nClass-leading screen brightness, breaking new industry records. New luminescent materials paired with aggressive tuning algorithms fear no dazzling sunlight, faithfully restoring light and dark. ‚Äî Realme GT 5 Pro\nIts peak brightness reaches an astonishing 4500 nits, but this is the ‚Äúlocal peak activated brightness‚Äù, achievable only under very stringent conditions (HDR content, strong light activation, a small window area), and has almost no practical value. The unfortunate part is that this high brightness, despite its lack of practical value, has become a key marketing focus and a crucial point of competition among manufacturers. Some product specification pages might even list only this brightness figure (the Realme Neo 7, with its 6000-nit peak brightness, is an example where other brightness specs might be omitted).\nSubsequently, the brightness war extended to full-screen activated and full-screen manual brightness. For instance, OnePlus and Xiaomi both provide an additional ‚Äúsunlight mode‚Äù, allowing users to set the manual brightness even higher. The marketing messages from various companies have unanimously referred to this high brightness as a ‚Äúsunlight display‚Äù, positing that its most practical application on a mobile phone is to enhance readability in bright environments.\nBrightness vs. Illuminance The readability of a screen in high ambient light is very complex. It is related to the displayed content and the electro-optical transfer function, and is a subjective, psychophysical quantity. One of the simplest ways to quantify this is through contrast: the ratio of the brightness when the screen is displaying white to its brightness when displaying black. Here, ‚Äòbrightness‚Äô refers to the combined luminance, which includes the ambient light reflected by the screen.\n$$ \\text{luminance}=\\frac{\\text{illuminance}*\\text{reflectance}}{\\pi}+\\text{display luminance} $$In the formula above, reflectance is the SCI (Specular Component Included) reflectance. Assuming the screen is under an infinitely large and uniform dome of light (such as outdoors), the luminance of the reflected light can be estimated by dividing by $\\pi$.\nAs illuminance increases, the contrast ratio drops rapidly (note that the y-axis in the graph below is on a logarithmic scale), leading to poor outdoor screen readability. This is perceived as the screen being difficult to see, or not appearing sufficiently ‚Äòclear‚Äô or ‚Äôtranslucent‚Äô.\nThe typical illuminance on a sunny day outdoors is approximately 50,000 lx. The reflectance of uncoated glass, including the specular component, is about 5%. Under these conditions, the contrast ratio is only around 2:1, and increasing the screen‚Äôs brightness has a limited effect.\nAn Alternative Approach: Reducing Screen Reflectance As the calculation above shows, increasing the contrast ratio is not solely achieved by increasing brightness; it can also be done by reducing the screen‚Äôs reflectance, which is possible through coatings. In fact, the iPad has featured an anti-reflective coating for a long time, and it is often highlighted in various comparison tests. Its reflection pattern presents as a dim, purplish-red colour. The iPhone, however, does not have this (perhaps due to durability concerns or the difficulty of applying coatings to Ceramic Shield glass). Samsung has already implemented this on its phones, and vivo made an attempt with the X100 Ultra by offering users a screen protector with an anti-reflective coating.\nUsing this technology, the screen‚Äôs reflectance can be lowered to under 2% (according to tests by DxO). Reducing screen reflectance is a relatively efficient method for improving the contrast ratio, with an effect equivalent to increasing the screen brightness to over 4000 nits.\nIt is worth noting that on modern mobile phones, almost all sensors are located beneath the screen or a screen protector. Vivo mentioned that because of the lower reflectance, phones with an anti-reflective film applied require a special firmware update to recalibrate these sensors.\nSome Findings and Speculations The reflectance including the specular component, when measured with an integrating sphere, yields results similar to those from DxO. I happened to have a brand-new iPhone 16 Pro, and its reflectance was significantly higher than that of a well-used Find X6 Pro without a screen protector. I speculate this is due to the properties of the microcrystalline glass (i.e., Ceramic Shield).\nSome phones also come with a matte surface from the factory, such as those with ‚Äòpaper-like‚Äô displays. Their diffuse reflectance (specular component excluded) is naturally much higher, whereas their total reflectance (specular component included) is comparable to that of standard phones.\nFurthermore, all the measurements above were conducted after wiping the screen completely clean. If the screen is smudged with fingerprints or grease, the reflectance will increase significantly, in particular introducing undesirable textures and anisotropic stray light. The display quality of demonstration phones in retail stores, which have been handled by many people, or of phones belonging to users who are not in the habit of cleaning their screens, will be noticeably degraded.\nA well-worn and heavily-rubbed iPad Pro 2021, which is equipped with an anti-reflective coating, has a reflectance of approximately 2%. However, below 400 nm, its reflectance soars to around 20%. Compared to the Find X6 Pro, its reflection is darker and more blueish.\n",
  "wordCount" : "849",
  "inLanguage": "en",
  "datePublished": "2025-03-14T16:00:00+08:00",
  "dateModified": "2025-03-14T16:00:00+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jackchou00.icu/en/posts/display-reflectance/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "üè°JacksBlog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jackchou00.icu/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jackchou00.icu/en/" accesskey="h" title="üè°JacksBlog (Alt + H)">üè°JacksBlog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://jackchou00.icu/" title="‰∏≠Êñá"
                            aria-label="‰∏≠Êñá">Zh-Cn</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jackchou00.icu/en/posts/" title="Posts üå≥">
                    <span>Posts üå≥</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou00.icu/en/photos/" title="Photos üì∑">
                    <span>Photos üì∑</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou00.icu/en/tags/" title="Tags üè∑Ô∏è">
                    <span>Tags üè∑Ô∏è</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou00.icu/en/about/" title="About üòº">
                    <span>About üòº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Reflectance: A Second Path to Readability in Bright Environments
    </h1>
    <div class="post-meta"><span title='2025-03-14 16:00:00 +0800 +0800'>2025.03.14</span>&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://jackchou00.icu/posts/display-reflectance/">Zh-Cn</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#brighter-and-brighter-still" aria-label="Brighter, and Brighter Still">Brighter, and Brighter Still</a></li>
                <li>
                    <a href="#brightness-vs-illuminance" aria-label="Brightness vs. Illuminance">Brightness vs. Illuminance</a></li>
                <li>
                    <a href="#an-alternative-approach-reducing-screen-reflectance" aria-label="An Alternative Approach: Reducing Screen Reflectance">An Alternative Approach: Reducing Screen Reflectance</a></li>
                <li>
                    <a href="#some-findings-and-speculations" aria-label="Some Findings and Speculations">Some Findings and Speculations</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="brighter-and-brighter-still">Brighter, and Brighter Still<a hidden class="anchor" aria-hidden="true" href="#brighter-and-brighter-still">#</a></h2>
<p>If I recall correctly, from the Realme GT 5 Pro onwards, the peak brightness of mobile phone screens has become increasingly &ldquo;exaggerated&rdquo;.</p>
<blockquote>
<p>Class-leading screen brightness, breaking new industry records. New luminescent materials paired with aggressive tuning algorithms fear no dazzling sunlight, faithfully restoring light and dark. ‚Äî Realme GT 5 Pro</p>
</blockquote>
<p>Its peak brightness reaches an astonishing 4500 nits, but this is the &ldquo;local peak activated brightness&rdquo;, achievable only under very stringent conditions (HDR content, strong light activation, a small window area), and has almost no practical value. The unfortunate part is that this high brightness, despite its lack of practical value, has become a key marketing focus and a crucial point of competition among manufacturers. Some product specification pages might even list only this brightness figure (the Realme Neo 7, with its 6000-nit peak brightness, is an example where other brightness specs might be omitted).</p>
<p>Subsequently, the brightness war extended to full-screen activated and full-screen manual brightness. For instance, OnePlus and Xiaomi both provide an additional &ldquo;sunlight mode&rdquo;, allowing users to set the manual brightness even higher. The marketing messages from various companies have unanimously referred to this high brightness as a &ldquo;sunlight display&rdquo;, positing that its most practical application on a mobile phone is to enhance readability in bright environments.</p>
<h2 id="brightness-vs-illuminance">Brightness vs. Illuminance<a hidden class="anchor" aria-hidden="true" href="#brightness-vs-illuminance">#</a></h2>
<p>The readability of a screen in high ambient light is very complex. It is related to the displayed content and the electro-optical transfer function, and is a subjective, psychophysical quantity. One of the simplest ways to quantify this is through contrast: the ratio of the brightness when the screen is displaying white to its brightness when displaying black. Here, &lsquo;brightness&rsquo; refers to the combined luminance, which includes the ambient light reflected by the screen.</p>
$$
\text{luminance}=\frac{\text{illuminance}*\text{reflectance}}{\pi}+\text{display luminance}
$$<p>In the formula above, reflectance is the SCI (Specular Component Included) reflectance. Assuming the screen is under an infinitely large and uniform dome of light (such as outdoors), the luminance of the reflected light can be estimated by dividing by $\pi$.</p>
<p>As illuminance increases, the contrast ratio drops rapidly (note that the y-axis in the graph below is on a logarithmic scale), leading to poor outdoor screen readability. This is perceived as the screen being difficult to see, or not appearing sufficiently &lsquo;clear&rsquo; or &rsquo;translucent&rsquo;.</p>
<p><img loading="lazy" src="https://img.jackchou00.icu/jack-img/2025/03/5c3672c33e3c1e6e0d7e593f0aaa09db.svg"></p>
<p>The typical illuminance on a sunny day outdoors is approximately 50,000 lx. The reflectance of uncoated glass, including the specular component, is about 5%. Under these conditions, the contrast ratio is only around 2:1, and increasing the screen&rsquo;s brightness has a limited effect.</p>
<p><img loading="lazy" src="https://img.jackchou00.icu/jack-img/2025/03/201215489a2972882d2e7ad00691087a.svg"></p>
<h2 id="an-alternative-approach-reducing-screen-reflectance">An Alternative Approach: Reducing Screen Reflectance<a hidden class="anchor" aria-hidden="true" href="#an-alternative-approach-reducing-screen-reflectance">#</a></h2>
<p>As the calculation above shows, increasing the contrast ratio is not solely achieved by increasing brightness; it can also be done by reducing the screen&rsquo;s reflectance, which is possible through coatings. In fact, the iPad has featured an anti-reflective coating for a long time, and it is often highlighted in various comparison tests. Its reflection pattern presents as a dim, purplish-red colour. The iPhone, however, does not have this (perhaps due to durability concerns or the difficulty of applying coatings to Ceramic Shield glass). Samsung has already implemented this on its phones, and vivo made an attempt with the X100 Ultra by offering users a screen protector with an anti-reflective coating.</p>
<p>Using this technology, the screen&rsquo;s reflectance can be lowered to under 2% (according to tests by DxO). Reducing screen reflectance is a relatively efficient method for improving the contrast ratio, with an effect equivalent to increasing the screen brightness to over 4000 nits.</p>
<p><img loading="lazy" src="https://img.jackchou00.icu/jack-img/2025/03/bbdd2deb2ed54f05e57fa88a19995455.svg"></p>
<p>It is worth noting that on modern mobile phones, almost all sensors are located beneath the screen or a screen protector. Vivo mentioned that because of the lower reflectance, phones with an anti-reflective film applied require a special firmware update to recalibrate these sensors.</p>
<h2 id="some-findings-and-speculations">Some Findings and Speculations<a hidden class="anchor" aria-hidden="true" href="#some-findings-and-speculations">#</a></h2>
<p>The reflectance including the specular component, when measured with an integrating sphere, yields results similar to those from DxO. I happened to have a brand-new iPhone 16 Pro, and its reflectance was significantly higher than that of a well-used Find X6 Pro without a screen protector. I speculate this is due to the properties of the microcrystalline glass (i.e., Ceramic Shield).</p>
<p><img loading="lazy" src="https://img.jackchou00.icu/jack-img/2025/03/d4d9e6e810e1dec9b4bcec01dbfafc84.svg"></p>
<p>Some phones also come with a matte surface from the factory, such as those with &lsquo;paper-like&rsquo; displays. Their diffuse reflectance (specular component excluded) is naturally much higher, whereas their total reflectance (specular component included) is comparable to that of standard phones.</p>
<p><img loading="lazy" src="https://img.jackchou00.icu/jack-img/2025/03/b6ca79c847941012064a2dd2f166ea23.svg"></p>
<p>Furthermore, all the measurements above were conducted after wiping the screen completely clean. If the screen is smudged with fingerprints or grease, the reflectance will increase significantly, in particular introducing undesirable textures and anisotropic stray light. The display quality of demonstration phones in retail stores, which have been handled by many people, or of phones belonging to users who are not in the habit of cleaning their screens, will be noticeably degraded.</p>
<p>A well-worn and heavily-rubbed iPad Pro 2021, which is equipped with an anti-reflective coating, has a reflectance of approximately 2%. However, below 400 nm, its reflectance soars to around 20%. Compared to the Find X6 Pro, its reflection is darker and more blueish.</p>
<p><img loading="lazy" src="https://img.jackchou00.icu/jack-img/2025/03/e221b486cc4d582474140682232189d2.avif"></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jackchou00.icu/en/tags/colour/">Colour</a></li>
      <li><a href="https://jackchou00.icu/en/tags/display/">Display</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://jackchou00.icu/en/posts/how-to-read-raw/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>How to Correctly Read RAW Files</span>
  </a>
  <a class="next" href="https://jackchou00.icu/en/posts/isp01/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Reincarnated into the ISP Isekai Day 0: Lost in the RAW Forest, I Summon RGB with a 3x3 Magic Array</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jackchou00.icu/en/">üè°JacksBlog</a></span> ¬∑ 
        my friends&rsquo; websites: <a href="https://zhxwu.com/">zhxwu</a> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
