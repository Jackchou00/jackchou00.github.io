<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Solving WSL2 Installation Failure Caused by &#39;Invisible&#39; Hyper-V | üè°JacksBlog</title>
<meta name="keywords" content="Code, AI, Anything, LLM">
<meta name="description" content="WSL2 still showing a virtualisation error even though BIOS and Windows Features are set up correctly? The problem might be these two hidden components.">
<meta name="author" content="Jack">
<link rel="canonical" href="https://jackchou.top/en/posts/wsl2-hyperv-install-fix/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e30af01949f15b214a659db89950589c44040efcfcdeec2087ad8629d77c216e.css" integrity="sha256-4wrwGUnxWyFKZZ24mVBYnEQEDvz83uwgh62GKdd8IW4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jackchou.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jackchou.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jackchou.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jackchou.top/apple-touch-icon.png">
<link rel="mask-icon" href="https://jackchou.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://jackchou.top/posts/wsl2-hyperv-install-fix/">
<link rel="alternate" hreflang="en" href="https://jackchou.top/en/posts/wsl2-hyperv-install-fix/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Google+Sans+Code:ital,wght@0,300..800;1,300..800&family=Noto+Sans+SC:wght@100..900&family=Sen:wght@400..800&display=swap" rel="stylesheet"><meta property="og:url" content="https://jackchou.top/en/posts/wsl2-hyperv-install-fix/">
  <meta property="og:site_name" content="üè°JacksBlog">
  <meta property="og:title" content="Solving WSL2 Installation Failure Caused by &#39;Invisible&#39; Hyper-V">
  <meta property="og:description" content="WSL2 still showing a virtualisation error even though BIOS and Windows Features are set up correctly? The problem might be these two hidden components.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-15T23:29:04+08:00">
    <meta property="article:modified_time" content="2025-10-15T23:29:04+08:00">
    <meta property="article:tag" content="Code">
    <meta property="article:tag" content="AI">
    <meta property="article:tag" content="Anything">
    <meta property="article:tag" content="LLM">
      <meta property="og:image" content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp">
<meta name="twitter:title" content="Solving WSL2 Installation Failure Caused by &#39;Invisible&#39; Hyper-V">
<meta name="twitter:description" content="WSL2 still showing a virtualisation error even though BIOS and Windows Features are set up correctly? The problem might be these two hidden components.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts üå≥",
      "item": "https://jackchou.top/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Solving WSL2 Installation Failure Caused by 'Invisible' Hyper-V",
      "item": "https://jackchou.top/en/posts/wsl2-hyperv-install-fix/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Solving WSL2 Installation Failure Caused by 'Invisible' Hyper-V",
  "name": "Solving WSL2 Installation Failure Caused by \u0027Invisible\u0027 Hyper-V",
  "description": "WSL2 still showing a virtualisation error even though BIOS and Windows Features are set up correctly? The problem might be these two hidden components.",
  "keywords": [
    "Code", "AI", "Anything", "LLM"
  ],
  "articleBody": "Why WSL Various CLI-based AI programming tools, like Codex, are not very good at running commands in PowerShell to edit files precisely. This is partly because they were likely trained more on Unix-like syntax, and partly because PowerShell lacks tools for precise file content manipulation. Therefore, installing WSL and then installing Codex within WSL is a better choice, and it‚Äôs also the approach recommended by OpenAI.\nTo understand why, we need to compare how the two environments handle files and commands.\nWhen modifying code, an AI agent can generate commands like sed, awk, diff, and patch. These tools act like surgical scalpels, allowing for stream editing of files with precision down to the line, column, or pattern. In contrast, the standard operation in PowerShell is a ‚Äúread-modify-writeback‚Äù cycle: Get-Content reads a file into memory, you modify the elements, and then Set-Content writes it back. This process is not only more cumbersome but also performs poorly with large files. The AI agent would need to expend more effort to reliably generate complex PowerShell code blocks to accomplish the same modifications.\nWSL2 allows the use of the Linux kernel‚Äôs native namespace technology to create a secure sandbox. This means the AI agent can run in an isolated environment where its file access is strictly confined to the project directory, and network access can be disabled. This greatly enhances the security of automated code modification.\nError: WSL2 Not Supported Even after enabling virtualisation in the BIOS and ticking the Hyper-V box in Windows Features as per online tutorials (which is actually unnecessary), the installation still fails. It reports that the system does not support WSL2, citing a virtualisation error and that Hyper-V is not installed.\nWsl/InstallDistro/Service/RegisterDistro/CreateVm/HCS/HCS_E_HYPERV_NOT_INSTALLED\nMost solutions online for this issue suggest manually checking and enabling Hyper-V via the command line, or using systeminfo to check for Hyper-V support, but none of these solved my problem.\nThe Invisible Hyper-V In reality, running the wsl --install command should automatically enable Hyper-V and related components, as stated on Microsoft‚Äôs website:\nThe wsl --install command does the following:\nEnables the optional WSL and Virtual Machine Platform components Downloads and installs the latest Linux kernel Sets WSL 2 as the default Downloads and installs the Ubuntu Linux distribution The failure might be due to some ‚Äúhidden‚Äù Hyper-V features not being enabled. Even if all Hyper-V related items appear ticked in the ‚ÄòTurn Windows features on or off‚Äô GUI, this could be misleading.\nLet‚Äôs use the command line to view all features. Note that dism is case-insensitive:\ndism /online /get-features These are usually shown as enabled and correspond to the Hyper-V options you see in the GUI.\nMicrosoft-Hyper-V-All Microsoft-Hyper-V Microsoft-Hyper-V-Tools-All Microsoft-Hyper-V-Management-PowerShell Microsoft-Hyper-V-Hypervisor Microsoft-Hyper-V-Services Microsoft-Hyper-V-Management-Clients However, there are two other features with ‚ÄòHyper-V‚Äô in their names that don‚Äôt appear in the GUI (perhaps due to a translation issue from Microsoft) nor are they enabled by the wsl --install command. These are likely the main cause of the failure.\nHyperV-KernelInt-VirtualDevice HyperV-Guest-KernelInt Use the command line to enable these two features, and then restart your system.\ndism /online /enable-feature /featurename:HyperV-KernelInt-VirtualDevice /all /norestart dism /online /enable-feature /featurename:HyperV-Guest-KernelInt /all /norestart After restarting, try the installation again. To avoid re-downloading the distribution (which can be very time-consuming, especially with internet conditions in mainland China), you can first run the wsl command without any arguments or wsl --status to check if the core components are working correctly. If there are no more errors, you can then proceed to install your desired distribution with wsl --install -d .\nIn Conclusion This was a very rare issue. I had never failed to install WSL with wsl --install before, but it happened. Perhaps a future WSL update will enable these two features‚Äîwhich may have been introduced in a recent update‚Äîby default.\nDocumenting this kind of tricky problem helps me get a blog post out of it, and it might also help some other unlucky person who runs into the same installation failure. It reminds me of how, back in the day, I‚Äôd often find solutions to obscure technical problems on old internet forums.\n",
  "wordCount" : "676",
  "inLanguage": "en",
  "image": "https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp","datePublished": "2025-10-15T23:29:04+08:00",
  "dateModified": "2025-10-15T23:29:04+08:00",
  "author":{
    "@type": "Person",
    "name": "Jack"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jackchou.top/en/posts/wsl2-hyperv-install-fix/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "üè°JacksBlog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jackchou.top/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jackchou.top/en/" accesskey="h" title="üè°JacksBlog (Alt + H)">üè°JacksBlog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://jackchou.top/" title="‰∏≠Êñá"
                            aria-label="‰∏≠Êñá">‰∏≠Êñá</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jackchou.top/en/posts/" title="Posts üå≥">
                    <span>Posts üå≥</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/photos/" title="Photos üì∑">
                    <span>Photos üì∑</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/tags/" title="Tags üè∑Ô∏è">
                    <span>Tags üè∑Ô∏è</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/about/" title="About üòº">
                    <span>About üòº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Solving WSL2 Installation Failure Caused by &#39;Invisible&#39; Hyper-V
    </h1>
    <div class="post-description">
      WSL2 still showing a virtualisation error even though BIOS and Windows Features are set up correctly? The problem might be these two hidden components.
    </div>
    <div class="post-meta"><span title='2025-10-15 23:29:04 +0800 +0800'>2025.10.15</span>&nbsp;¬∑&nbsp;Jack&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://jackchou.top/posts/wsl2-hyperv-install-fix/">‰∏≠Êñá</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#why-wsl" aria-label="Why WSL">Why WSL</a></li>
                <li>
                    <a href="#error-wsl2-not-supported" aria-label="Error: WSL2 Not Supported">Error: WSL2 Not Supported</a></li>
                <li>
                    <a href="#the-invisible-hyper-v" aria-label="The Invisible Hyper-V">The Invisible Hyper-V</a></li>
                <li>
                    <a href="#in-conclusion" aria-label="In Conclusion">In Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="why-wsl">Why WSL<a hidden class="anchor" aria-hidden="true" href="#why-wsl">#</a></h2>
<p>Various CLI-based AI programming tools, like Codex, are not very good at running commands in PowerShell to edit files precisely. This is partly because they were likely trained more on Unix-like syntax, and partly because PowerShell lacks tools for precise file content manipulation. Therefore, installing WSL and then installing Codex within WSL is a better choice, and it&rsquo;s also the approach recommended by OpenAI.</p>
<p>To understand why, we need to compare how the two environments handle files and commands.</p>
<p>When modifying code, an AI agent can generate commands like <code>sed</code>, <code>awk</code>, <code>diff</code>, and <code>patch</code>. These tools act like surgical scalpels, allowing for stream editing of files with precision down to the line, column, or pattern. In contrast, the standard operation in PowerShell is a &ldquo;read-modify-writeback&rdquo; cycle: <code>Get-Content</code> reads a file into memory, you modify the elements, and then <code>Set-Content</code> writes it back. This process is not only more cumbersome but also performs poorly with large files. The AI agent would need to expend more effort to reliably generate complex PowerShell code blocks to accomplish the same modifications.</p>
<p>WSL2 allows the use of the Linux kernel&rsquo;s native namespace technology to create a secure sandbox. This means the AI agent can run in an isolated environment where its file access is strictly confined to the project directory, and network access can be disabled. This greatly enhances the security of automated code modification.</p>
<h2 id="error-wsl2-not-supported">Error: WSL2 Not Supported<a hidden class="anchor" aria-hidden="true" href="#error-wsl2-not-supported">#</a></h2>
<p>Even after enabling virtualisation in the BIOS and ticking the Hyper-V box in Windows Features as per online tutorials (which is actually unnecessary), the installation still fails. It reports that the system does not support WSL2, citing a virtualisation error and that Hyper-V is not installed.</p>
<blockquote>
<p>Wsl/InstallDistro/Service/RegisterDistro/CreateVm/HCS/HCS_E_HYPERV_NOT_INSTALLED</p>
</blockquote>
<p>Most solutions online for this issue suggest manually checking and enabling Hyper-V via the command line, or using <code>systeminfo</code> to check for Hyper-V support, but none of these solved my problem.</p>
<h2 id="the-invisible-hyper-v">The Invisible Hyper-V<a hidden class="anchor" aria-hidden="true" href="#the-invisible-hyper-v">#</a></h2>
<p>In reality, running the <code>wsl --install</code> command should automatically enable Hyper-V and related components, as stated on Microsoft&rsquo;s website:</p>
<p>The <code>wsl --install</code> command does the following:</p>
<ul>
<li>Enables the optional WSL and Virtual Machine Platform components</li>
<li>Downloads and installs the latest Linux kernel</li>
<li>Sets WSL 2 as the default</li>
<li>Downloads and installs the Ubuntu Linux distribution</li>
</ul>
<p>The failure might be due to some &ldquo;hidden&rdquo; Hyper-V features not being enabled. Even if all Hyper-V related items appear ticked in the &lsquo;Turn Windows features on or off&rsquo; GUI, this could be misleading.</p>
<p>Let&rsquo;s use the command line to view all features. Note that <code>dism</code> is case-insensitive:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>dism /online /get-features
</span></span></code></pre></div><p>These are usually shown as enabled and correspond to the Hyper-V options you see in the GUI.</p>
<ul>
<li>Microsoft-Hyper-V-All</li>
<li>Microsoft-Hyper-V</li>
<li>Microsoft-Hyper-V-Tools-All</li>
<li>Microsoft-Hyper-V-Management-PowerShell</li>
<li>Microsoft-Hyper-V-Hypervisor</li>
<li>Microsoft-Hyper-V-Services</li>
<li>Microsoft-Hyper-V-Management-Clients</li>
</ul>
<p>However, there are two other features with &lsquo;Hyper-V&rsquo; in their names that don&rsquo;t appear in the GUI (perhaps due to a translation issue from Microsoft) nor are they enabled by the <code>wsl --install</code> command. These are likely the main cause of the failure.</p>
<ul>
<li>HyperV-KernelInt-VirtualDevice</li>
<li>HyperV-Guest-KernelInt</li>
</ul>
<p>Use the command line to enable these two features, and then restart your system.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>dism /online /enable-feature /featurename<span style="color:#960050;background-color:#1e0010">:</span>HyperV-KernelInt-VirtualDevice /all /norestart
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dism /online /enable-feature /featurename<span style="color:#960050;background-color:#1e0010">:</span>HyperV-Guest-KernelInt /all /norestart
</span></span></code></pre></div><p>After restarting, try the installation again. To avoid re-downloading the distribution (which can be very time-consuming, especially with internet conditions in mainland China), you can first run the <code>wsl</code> command without any arguments or <code>wsl --status</code> to check if the core components are working correctly. If there are no more errors, you can then proceed to install your desired distribution with <code>wsl --install -d &lt;DistroName&gt;</code>.</p>
<h2 id="in-conclusion">In Conclusion<a hidden class="anchor" aria-hidden="true" href="#in-conclusion">#</a></h2>
<p>This was a very rare issue. I had never failed to install WSL with <code>wsl --install</code> before, but it happened. Perhaps a future WSL update will enable these two features‚Äîwhich may have been introduced in a recent update‚Äîby default.</p>
<p>Documenting this kind of tricky problem helps me get a blog post out of it, and it might also help some other unlucky person who runs into the same installation failure. It reminds me of how, back in the day, I&rsquo;d often find solutions to obscure technical problems on old internet forums.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jackchou.top/en/tags/code/">Code</a></li>
      <li><a href="https://jackchou.top/en/tags/ai/">AI</a></li>
      <li><a href="https://jackchou.top/en/tags/anything/">Anything</a></li>
      <li><a href="https://jackchou.top/en/tags/llm/">LLM</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jackchou.top/en/">üè°JacksBlog</a></span> ¬∑ 
        my friends&rsquo; websites: <a href="https://zhxwu.com/">zhxwu.com</a>, <a href="https://ylqian.com/">ylqian.com</a> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div style="text-align: center; margin-top: 10px; margin-bottom: 20px; width: 100%; display: flex; justify-content: center;">
    <img src="https://visitor-badge.laobi.icu/badge?page_id=jacksblog" alt="visitors" style="max-width: 120px; height: auto;" />
</div><script>
(() => {
    const images = document.querySelectorAll('.post-content img');
    if (!images.length) return;

    const overlay = document.createElement('div');
    overlay.className = 'image-lightbox';
    overlay.innerHTML = '<img class="image-lightbox__img" alt="" />';

    const overlayImg = overlay.querySelector('img');
    const closeOverlay = () => {
        overlay.classList.remove('is-visible');
        overlayImg.removeAttribute('src');
        document.body.style.removeProperty('overflow');
    };

    overlay.addEventListener('click', closeOverlay);
    document.addEventListener('keyup', (event) => {
        if (event.key === 'Escape' && overlay.classList.contains('is-visible')) {
            closeOverlay();
        }
    });

    document.body.appendChild(overlay);

    images.forEach((img) => {
        img.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();

            const source = img.dataset.zoomSrc || img.currentSrc || img.src;
            const cleanSrc = source.split('#')[0];

            overlayImg.src = cleanSrc;
            overlayImg.alt = img.alt || '';

            overlay.classList.add('is-visible');
            document.body.style.setProperty('overflow', 'hidden');
        });
    });
})();
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
