<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Correctly Read RAW Files | JacksBlog</title>
<meta name=keywords content="camera RAW,libraw,rawpy,dcraw"><meta name=description content="Compare dcraw, Rawpy, and LibRaw for extracting RAW image data. Analyze their support for Sony, Canon, Hasselblad, Fujifilm cameras and 16-bit TIFF demosaicing."><meta name=author content="Miaosen Zhou"><link rel=canonical href=https://jackchou.top/en/posts/how-to-read-raw/><link crossorigin=anonymous href=/assets/css/stylesheet.07f6d388270a92c62af4a6f9c96374ae63b804ca5e22b2e4f3d2e446ce05d1b5.css integrity="sha256-B/bTiCcKksYq9Kb5yWN0rmO4BMpeIrLk89LkRs4F0bU=" rel="preload stylesheet" as=style><link rel=icon href=https://jackchou.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jackchou.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jackchou.top/favicon-32x32.png><link rel=apple-touch-icon href=https://jackchou.top/apple-touch-icon.png><link rel=mask-icon href=https://jackchou.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://jackchou.top/posts/how-to-read-raw/><link rel=alternate hreflang=en href=https://jackchou.top/en/posts/how-to-read-raw/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://cdn.jsdelivr.net><meta property="og:url" content="https://jackchou.top/en/posts/how-to-read-raw/"><meta property="og:site_name" content="JacksBlog"><meta property="og:title" content="How to Correctly Read RAW Files"><meta property="og:description" content="Compare dcraw, Rawpy, and LibRaw for extracting RAW image data. Analyze their support for Sony, Canon, Hasselblad, Fujifilm cameras and 16-bit TIFF demosaicing."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-28T00:00:00+08:00"><meta property="article:modified_time" content="2025-12-21T00:41:45+08:00"><meta property="article:tag" content="Colour"><meta property="article:tag" content="ISP"><meta property="og:image" content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp"><meta name=twitter:title content="How to Correctly Read RAW Files"><meta name=twitter:description content="Compare dcraw, Rawpy, and LibRaw for extracting RAW image data. Analyze their support for Sony, Canon, Hasselblad, Fujifilm cameras and 16-bit TIFF demosaicing."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts üå≥","item":"https://jackchou.top/en/posts/"},{"@type":"ListItem","position":2,"name":"How to Correctly Read RAW Files","item":"https://jackchou.top/en/posts/how-to-read-raw/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Correctly Read RAW Files","name":"How to Correctly Read RAW Files","description":"Compare dcraw, Rawpy, and LibRaw for extracting RAW image data. Analyze their support for Sony, Canon, Hasselblad, Fujifilm cameras and 16-bit TIFF demosaicing.","keywords":["camera RAW","libraw","rawpy","dcraw"],"articleBody":"Rotating Images The examples below assume the image was shot in landscape orientation. If you need to align portrait shots, rotate them according to the EXIF Orientation tag. For example, using Python‚Äôs exifread:\nwith open(image_path, 'rb') as f: tags = exifread.process_file(f) orientation = tags.get('Image Orientation', 'Unknown') print(f\"Image Orientation: {orientation}\") # e.g. Rotated 90 CCW Tools for Reading RAW Data Dcraw The most famous tool for reading RAW data is undoubtedly dcraw. Dcraw can convert RAW files of various encoding formats into TIFF or PPM format.\nUsing the command line dcraw -4 -T -D file_name yields a 16-bit TIFF file that records the direct RAW values, without any processing such as demosaicing, white balancing, or black level subtraction.\nUnfortunately, dcraw‚Äôs last update was on 1 June 2018. Consequently, it no longer includes additional parameters (like white balance, colour matrices, etc.) for cameras released after that date, and even its core function of extracting RAW data may not work reliably.\nFor instance, with the lossless compressed RAW format introduced by Sony in their fourth-generation cameras (e.g., ILCE-7M4), dcraw reports a ‚Äúcannot decode file‚Äù error, even though the file extension is still .arw. In contrast, it can still decode the older uncompressed RAW format.\ndcraw.c is the core file of dcraw, consisting of over ten thousand lines of pure C code.\nRawpy/LibRaw Rawpy is a Python wrapper for LibRaw. LibRaw provides a unified interface for accessing RAW data to extract pixel values. It is based on dcraw, having refactored dcraw.c into a more modern and modular library, and has continued to be supported after dcraw ceased development.\nDifferences Between Methods and Brands Sony Uncompressed RAW On newer bodies (likely from the ZV-E10 II onward), Sony no longer offers an uncompressed RAW option.\nTest model: ILCE-7CM2:\nThe following methods yield identical results when reading uncompressed RAW files:\nConverting with Dcraw to TIFF and then reading with OpenImageIO Reading directly with Rawpy Converting with Adobe DNG Converter and then reading with Rawpy Converting with Adobe Camera Raw and then reading with Rawpy (same as above, although the dimensions appear different when viewed in ACR) Converting with Adobe DNG Converter, then converting to TIFF with dcraw, and finally reading with OIIO The dimensions read by all the methods above are (4688, 7040); in short, every approach produces the same result because the file is uncompressed.\nIn practice, the DNG files converted by Adobe DNG Converter and Adobe Camera Raw are completely identical, so this will not be detailed further. Reading DNG files with Rawpy and dcraw is also equivalent.\nLossless Compressed RAW Sony‚Äôs lossless compressed RAW pads the data with zeros so both dimensions are multiples of 512, then splits it into blocks, and applies differential and Huffman coding to four Bayer sub-images.\nFor lossless compressed RAW, things are more complex because there is currently no way to convert between uncompressed ARW and lossless compressed ARW files. The tested scenarios are:\nDcraw does not support lossless compressed RAW (as Sony introduced it after dcraw was no longer being updated). Reading the ARW with Rawpy yields dimensions of (5120, 7168). This is due to the block-based compression (a multiple of 512). Only the top-left (4688, 7040) area contains image data; the rest is filled with zeros (not the black level), and the values range from 0-16383. After converting to DNG with Adobe DNG Converter and then reading with Rawpy, the resulting dimensions are (4686, 7038), which is two pixels smaller in each dimension than the uncompressed RAW. If you crop 2 pixels from the bottom and 2 from the right of the padded image from the previous scenario, the results match perfectly, also with a range of 0-16383. Compressed RAW: Compressed HQ Sony‚Äôs old lossy compressed RAW was infamous for its artifacts. Starting with the a7M5, Sony introduced an improved lossy mode called Compressed HQ, which aims to balance quality and file size. At present, only Sony‚Äôs own IEDT can decode this format. Once third-party tools add support, we can evaluate it more closely.\nRegarding DNGs from Capture One and Other Software Theoretically, a codec that decodes RAW and encodes to DNG should not introduce complex errors. However, DNGs exported from Capture One not only have different dimensions but also stretch the original 14-bit data to 16-bit, and they do not perfectly match the RAW data read by other methods.\nWith the help of Gemini and DeepSeek, a more detailed analysis was conducted. Regarding the conversion from 14-bit to 16-bit, Capture One appears to perform a left bit shift by two places, which is equivalent to multiplying by 4. After left-shifting the ARW data read by Rawpy and then comparing it with the C1-exported DNG (by division and subtraction), the resulting quotient is 1.000004, and the difference is on the order of e-7. The R and B channels match perfectly; all errors come from the two G channels and are content-dependent. In some images, the maximum error in the G channels can reach up to 10%, though in most cases, it does not exceed 5%.\nDNG is a specification-driven format and should not modify the RAW data itself, so it‚Äôs best to avoid using non-Adobe tools to convert RAW images to DNG.\nBest Practices for Sony RAW In summary, the recommended approach for using Sony RAW files is to shoot in uncompressed RAW and then read them directly with Rawpy. You can use Adobe DNG Converter to conveniently convert uncompressed RAW files into lossless compressed DNGs to reduce file size without any loss. Alternatively, you can read lossless compressed RAW files with Rawpy and crop them, but be aware that converting lossless compressed RAW to DNG will result in the loss of two rows and two columns of pixels.\nCanon Test model: a 600D pulled from a dataset, which outputs CR2 files.\nReading with Rawpy and reading after conversion to DNG yield identical results. The image dimensions are (3516, 5344). The 142 pixels on the left and 51 pixels on the top appear to be the optical black area (the part physically masked for black level calibration), which reads out values close to the black level. The remainder is the image.\nDcraw can process files from the 600D. It reads out the part without the optical black area, which matches the cropped data from Rawpy or a DNG conversion.\nThe CR3 output from an R6 Mark II (read with Rawpy or via DNG conversion) is similar. The left 154 pixels and top 96 pixels constitute the optical black area, and there is also a white area of 8 pixels on the right.\nFor the R6 Mark III, the optical black areas seem to be gone; the entire readout is image data. The CR3 format is impressively advanced‚Äîit‚Äôs lossless while still achieving a high compression ratio.\nHasselblad The test model is the Hasselblad X2D-100C, which directly outputs RAW files in 3FR format. The sensor model can be confirmed directly from the 3FR file as the Sony IMX461-BQR.\nHasselblad‚Äôs historical RAW workflow involved two file formats: 3FR and FFF.\nWith the release of the new version of Phocus, the FFF file has been removed from the RAW workflow, and it is now unnecessary to convert to FFF before processing RAW images.\nIn the older workflow, users could convert 3FR to FFF via the Phocus software. There were some optional adjustment settings during conversion, but these did not affect the FFF file‚Äôs original data (for instance, the results read using rawpy were the same). From the file header, it can be seen that 3FR (49 49 2A 00) follows the little-endian TIFF specification, while FFF (4D 4D 00 2A) is big-endian TIFF.\nThe public specifications for the IMX461-BQR show a total pixel count of 11760√ó8896 and an effective pixel count of 11664√ó8750. However, directly parsing the 3FR file using tools like dcraw or rawpy yields an oversized image of 11904√ó8842. This image contains the following areas:\nImage Content Area: Dimensions are 11664√ó8750, consistent with the 461‚Äôs effective pixels. Optical Black: Surrounding the image content area, 48px on the left and right, and 90px on the top. Additional Content: On the outermost periphery, including 76px on the left, 68px on the right, and 2px on the top of non-image data. Analysis shows that the image width including the Optical Black field is 11760px (which matches the sensor‚Äôs total pixel width), but the height is 8840px, showing a slight discrepancy.\nBoth 3FR and FFF can be converted to the DNG format. The size of the converted DNG file will be cropped to match the effective pixel area. In terms of content, although the image content is aligned, there are some minor numerical differences.\nTherefore, the current best practice for processing Hasselblad 3FR files appears to be directly using libraw to read and extract the effective image area, and utilizing the Optical Black data within the image for precise black level correction.\nFujifilm Test model: X-T5.\nFujifilm‚Äôs RAW files are rather unique because their colour filter array is not a standard Bayer pattern but an X-Trans pattern, which has a minimum repeating unit of 6x6 pixels. Fortunately, this does not affect our analysis of the raw image data itself.\nFeeding the RAF file directly into Rawpy yields an image with a width of 7872 and a height of 5196. After conversion to DNG, the width is 7728 and the height is 5152. The distribution of the extra 144 pixels in width and 44 pixels in height is as follows:\n12 pixels of image data on the left; 12 pixels of image data and 120 black pixels on the right. 16 pixels of image data and 5 black pixels at the top; 16 pixels of image data and 7 black pixels at the bottom. The pixel values in the overlapping areas are identical.\nAdditionally, Rawpy reads the RAF‚Äôs raw pattern incorrectly, whereas the raw pattern in the DNG is correct.\nOne caution: LibRaw provides a halfsize option that merges RGGB into a single pixel to output a half-resolution three-channel image. In theory, this should not be used on X-Trans sensors, but LibRaw still allows it, seemingly running the same pipeline as Bayer sensors and producing incorrect results.\nNikon Nikon is the simplest case. The test model is a Z6 outputting NEF files. Reading directly with LibRaw or after conversion to DNG yields images of (6064, 4040); there is no extra padding, and the content is identical.\nSummary The easiest workflow is usually to convert to DNG: the files get smaller, the format is unified, and non-image regions are cropped away for easier processing. If you want to preserve the original format, metadata, and cropped-out regions, read the original RAW with LibRaw or Rawpy. Across most tests, the overlapping image areas have identical pixel values.\nAvoid using non-Adobe tools to convert RAW to DNG. Since dcraw is no longer maintained, migrate to LibRaw/Rawpy.\n","wordCount":"1808","inLanguage":"en","image":"https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp","datePublished":"2025-03-28T00:00:00+08:00","dateModified":"2025-12-21T00:41:45+08:00","author":{"@type":"Person","name":"Miaosen Zhou"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jackchou.top/en/posts/how-to-read-raw/"},"publisher":{"@type":"Organization","name":"JacksBlog","logo":{"@type":"ImageObject","url":"https://jackchou.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jackchou.top/en/ accesskey=h title="JacksBlog (Alt + H)">JacksBlog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://jackchou.top/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>‰∏≠Êñá</a></li></ul></div></div><ul id=menu><li><a href=https://jackchou.top/en/posts/ title="Posts üå≥"><span>Posts üå≥</span></a></li><li><a href=https://jackchou.top/en/photos/ title="Photos üì∑"><span>Photos üì∑</span></a></li><li><a href=https://jackchou.top/en/tags/ title="Tags üè∑Ô∏è"><span>Tags üè∑Ô∏è</span></a></li><li><a href=https://jackchou.top/en/about/ title="About üòº"><span>About üòº</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">How to Correctly Read RAW Files</h1><div class=post-meta><span title='2025-03-28 00:00:00 +0800 +0800'>2025.03.28</span>&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://jackchou.top/posts/how-to-read-raw/>‰∏≠Êñá</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#rotating-images aria-label="Rotating Images">Rotating Images</a></li><li><a href=#tools-for-reading-raw-data aria-label="Tools for Reading RAW Data">Tools for Reading RAW Data</a><ul><li><a href=#dcraw aria-label=Dcraw>Dcraw</a></li><li><a href=#rawpylibraw aria-label=Rawpy/LibRaw>Rawpy/LibRaw</a></li></ul></li><li><a href=#differences-between-methods-and-brands aria-label="Differences Between Methods and Brands">Differences Between Methods and Brands</a><ul><li><a href=#sony aria-label=Sony>Sony</a><ul><li><a href=#uncompressed-raw aria-label="Uncompressed RAW">Uncompressed RAW</a></li><li><a href=#lossless-compressed-raw aria-label="Lossless Compressed RAW">Lossless Compressed RAW</a></li><li><a href=#compressed-raw-compressed-hq aria-label="Compressed RAW: Compressed HQ">Compressed RAW: Compressed HQ</a></li><li><a href=#regarding-dngs-from-capture-one-and-other-software aria-label="Regarding DNGs from Capture One and Other Software">Regarding DNGs from Capture One and Other Software</a></li><li><a href=#best-practices-for-sony-raw aria-label="Best Practices for Sony RAW">Best Practices for Sony RAW</a></li></ul></li><li><a href=#canon aria-label=Canon>Canon</a></li><li><a href=#hasselblad aria-label=Hasselblad>Hasselblad</a></li><li><a href=#fujifilm aria-label=Fujifilm>Fujifilm</a></li><li><a href=#nikon aria-label=Nikon>Nikon</a></li></ul></li><li><a href=#summary aria-label=Summary>Summary</a></li></ul></div></details></div><div class=post-content><h2 id=rotating-images>Rotating Images<a hidden class=anchor aria-hidden=true href=#rotating-images>#</a></h2><p>The examples below assume the image was shot in landscape orientation. If you need to align portrait shots, rotate them according to the EXIF <code>Orientation</code> tag. For example, using Python&rsquo;s <code>exifread</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> open(image_path, <span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    tags <span style=color:#f92672>=</span> exifread<span style=color:#f92672>.</span>process_file(f)
</span></span><span style=display:flex><span>    orientation <span style=color:#f92672>=</span> tags<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Image Orientation&#39;</span>, <span style=color:#e6db74>&#39;Unknown&#39;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Image Orientation: </span><span style=color:#e6db74>{</span>orientation<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>) <span style=color:#75715e># e.g. Rotated 90 CCW</span>
</span></span></code></pre></div><h2 id=tools-for-reading-raw-data>Tools for Reading RAW Data<a hidden class=anchor aria-hidden=true href=#tools-for-reading-raw-data>#</a></h2><h3 id=dcraw>Dcraw<a hidden class=anchor aria-hidden=true href=#dcraw>#</a></h3><p>The most famous tool for reading RAW data is undoubtedly dcraw. Dcraw can convert RAW files of various encoding formats into TIFF or PPM format.</p><p>Using the command line <code>dcraw -4 -T -D file_name</code> yields a 16-bit TIFF file that records the direct RAW values, without any processing such as demosaicing, white balancing, or black level subtraction.</p><p>Unfortunately, dcraw&rsquo;s last update was on 1 June 2018. Consequently, it no longer includes additional parameters (like white balance, colour matrices, etc.) for cameras released after that date, and even its core function of extracting RAW data may not work reliably.</p><p>For instance, with the lossless compressed RAW format introduced by Sony in their fourth-generation cameras (e.g., ILCE-7M4), dcraw reports a &ldquo;cannot decode file&rdquo; error, even though the file extension is still .arw. In contrast, it can still decode the older uncompressed RAW format.</p><p><code>dcraw.c</code> is the core file of dcraw, consisting of over ten thousand lines of pure C code.</p><h3 id=rawpylibraw>Rawpy/LibRaw<a hidden class=anchor aria-hidden=true href=#rawpylibraw>#</a></h3><p>Rawpy is a Python wrapper for LibRaw. LibRaw provides a unified interface for accessing RAW data to extract pixel values. It is based on dcraw, having refactored <code>dcraw.c</code> into a more modern and modular library, and has continued to be supported after dcraw ceased development.</p><h2 id=differences-between-methods-and-brands>Differences Between Methods and Brands<a hidden class=anchor aria-hidden=true href=#differences-between-methods-and-brands>#</a></h2><h3 id=sony>Sony<a hidden class=anchor aria-hidden=true href=#sony>#</a></h3><h4 id=uncompressed-raw>Uncompressed RAW<a hidden class=anchor aria-hidden=true href=#uncompressed-raw>#</a></h4><blockquote><p>On newer bodies (likely from the ZV-E10 II onward), Sony no longer offers an uncompressed RAW option.</p></blockquote><p>Test model: ILCE-7CM2:</p><p>The following methods yield identical results when reading uncompressed RAW files:</p><ul><li>Converting with Dcraw to TIFF and then reading with OpenImageIO</li><li>Reading directly with Rawpy</li><li>Converting with Adobe DNG Converter and then reading with Rawpy</li><li>Converting with Adobe Camera Raw and then reading with Rawpy (same as above, although the dimensions appear different when viewed in ACR)</li><li>Converting with Adobe DNG Converter, then converting to TIFF with dcraw, and finally reading with OIIO</li></ul><p>The dimensions read by all the methods above are (4688, 7040); in short, every approach produces the same result because the file is uncompressed.</p><p>In practice, the DNG files converted by Adobe DNG Converter and Adobe Camera Raw are completely identical, so this will not be detailed further. Reading DNG files with Rawpy and dcraw is also equivalent.</p><h4 id=lossless-compressed-raw>Lossless Compressed RAW<a hidden class=anchor aria-hidden=true href=#lossless-compressed-raw>#</a></h4><p>Sony&rsquo;s lossless compressed RAW pads the data with zeros so both dimensions are multiples of 512, then splits it into blocks, and applies differential and Huffman coding to four Bayer sub-images.</p><p>For lossless compressed RAW, things are more complex because there is currently no way to convert between uncompressed ARW and lossless compressed ARW files. The tested scenarios are:</p><ul><li>Dcraw does not support lossless compressed RAW (as Sony introduced it after dcraw was no longer being updated).</li><li>Reading the ARW with Rawpy yields dimensions of (5120, 7168). This is due to the block-based compression (a multiple of 512). Only the top-left (4688, 7040) area contains image data; the rest is filled with zeros (not the black level), and the values range from 0-16383.</li><li>After converting to DNG with Adobe DNG Converter and then reading with Rawpy, the resulting dimensions are (4686, 7038), which is two pixels smaller in each dimension than the uncompressed RAW. If you crop 2 pixels from the bottom and 2 from the right of the padded image from the previous scenario, the results match perfectly, also with a range of 0-16383.</li></ul><h4 id=compressed-raw-compressed-hq>Compressed RAW: Compressed HQ<a hidden class=anchor aria-hidden=true href=#compressed-raw-compressed-hq>#</a></h4><p>Sony&rsquo;s old lossy compressed RAW was infamous for its artifacts. Starting with the a7M5, Sony introduced an improved lossy mode called Compressed HQ, which aims to balance quality and file size. At present, only Sony&rsquo;s own IEDT can decode this format. Once third-party tools add support, we can evaluate it more closely.</p><h4 id=regarding-dngs-from-capture-one-and-other-software>Regarding DNGs from Capture One and Other Software<a hidden class=anchor aria-hidden=true href=#regarding-dngs-from-capture-one-and-other-software>#</a></h4><p>Theoretically, a codec that decodes RAW and encodes to DNG should not introduce complex errors. However, DNGs exported from Capture One not only have different dimensions but also stretch the original 14-bit data to 16-bit, and they do not perfectly match the RAW data read by other methods.</p><p>With the help of Gemini and DeepSeek, a more detailed analysis was conducted. Regarding the conversion from 14-bit to 16-bit, Capture One appears to perform a left bit shift by two places, which is equivalent to multiplying by 4. After left-shifting the ARW data read by Rawpy and then comparing it with the C1-exported DNG (by division and subtraction), the resulting quotient is 1.000004, and the difference is on the order of e-7. The R and B channels match perfectly; all errors come from the two G channels and are content-dependent. In some images, the maximum error in the G channels can reach up to 10%, though in most cases, it does not exceed 5%.</p><p>DNG is a specification-driven format and should not modify the RAW data itself, so it&rsquo;s best to avoid using non-Adobe tools to convert RAW images to DNG.</p><h4 id=best-practices-for-sony-raw>Best Practices for Sony RAW<a hidden class=anchor aria-hidden=true href=#best-practices-for-sony-raw>#</a></h4><p>In summary, the recommended approach for using Sony RAW files is to shoot in uncompressed RAW and then read them directly with Rawpy. You can use Adobe DNG Converter to conveniently convert uncompressed RAW files into lossless compressed DNGs to reduce file size without any loss. Alternatively, you can read lossless compressed RAW files with Rawpy and crop them, but be aware that converting lossless compressed RAW to DNG will result in the loss of two rows and two columns of pixels.</p><h3 id=canon>Canon<a hidden class=anchor aria-hidden=true href=#canon>#</a></h3><p>Test model: a 600D pulled from a dataset, which outputs CR2 files.</p><p>Reading with Rawpy and reading after conversion to DNG yield identical results. The image dimensions are (3516, 5344). The 142 pixels on the left and 51 pixels on the top appear to be the optical black area (the part physically masked for black level calibration), which reads out values close to the black level. The remainder is the image.</p><p>Dcraw can process files from the 600D. It reads out the part without the optical black area, which matches the cropped data from Rawpy or a DNG conversion.</p><p>The CR3 output from an R6 Mark II (read with Rawpy or via DNG conversion) is similar. The left 154 pixels and top 96 pixels constitute the optical black area, and there is also a white area of 8 pixels on the right.</p><p>For the R6 Mark III, the optical black areas seem to be gone; the entire readout is image data. The CR3 format is impressively advanced‚Äîit&rsquo;s lossless while still achieving a high compression ratio.</p><h3 id=hasselblad>Hasselblad<a hidden class=anchor aria-hidden=true href=#hasselblad>#</a></h3><p>The test model is the Hasselblad X2D-100C, which directly outputs RAW files in 3FR format. The sensor model can be confirmed directly from the 3FR file as the Sony IMX461-BQR.</p><p>Hasselblad&rsquo;s historical RAW workflow involved two file formats: 3FR and FFF.</p><blockquote><p>With the release of the new version of Phocus, the FFF file has been removed from the RAW workflow, and it is now unnecessary to convert to FFF before processing RAW images.</p></blockquote><p>In the older workflow, users could convert 3FR to FFF via the Phocus software. There were some optional adjustment settings during conversion, but these did not affect the FFF file&rsquo;s original data (for instance, the results read using rawpy were the same). From the file header, it can be seen that 3FR (49 49 2A 00) follows the little-endian TIFF specification, while FFF (4D 4D 00 2A) is big-endian TIFF.</p><p>The public specifications for the IMX461-BQR show a total pixel count of 11760√ó8896 and an effective pixel count of 11664√ó8750. However, directly parsing the 3FR file using tools like dcraw or rawpy yields an oversized image of 11904√ó8842. This image contains the following areas:</p><ul><li>Image Content Area: Dimensions are 11664√ó8750, consistent with the 461&rsquo;s effective pixels.</li><li>Optical Black: Surrounding the image content area, 48px on the left and right, and 90px on the top.</li><li>Additional Content: On the outermost periphery, including 76px on the left, 68px on the right, and 2px on the top of non-image data.</li></ul><p>Analysis shows that the image width including the Optical Black field is 11760px (which matches the sensor&rsquo;s total pixel width), but the height is 8840px, showing a slight discrepancy.</p><p>Both 3FR and FFF can be converted to the DNG format. The size of the converted DNG file will be cropped to match the effective pixel area. In terms of content, although the image content is aligned, there are some minor numerical differences.</p><p>Therefore, the current best practice for processing Hasselblad 3FR files appears to be directly using libraw to read and extract the effective image area, and utilizing the Optical Black data within the image for precise black level correction.</p><h3 id=fujifilm>Fujifilm<a hidden class=anchor aria-hidden=true href=#fujifilm>#</a></h3><p>Test model: X-T5.</p><p>Fujifilm&rsquo;s RAW files are rather unique because their colour filter array is not a standard Bayer pattern but an X-Trans pattern, which has a minimum repeating unit of 6x6 pixels. Fortunately, this does not affect our analysis of the raw image data itself.</p><p>Feeding the RAF file directly into Rawpy yields an image with a width of 7872 and a height of 5196. After conversion to DNG, the width is 7728 and the height is 5152. The distribution of the extra 144 pixels in width and 44 pixels in height is as follows:</p><ul><li>12 pixels of image data on the left; 12 pixels of image data and 120 black pixels on the right.</li><li>16 pixels of image data and 5 black pixels at the top; 16 pixels of image data and 7 black pixels at the bottom.</li></ul><p>The pixel values in the overlapping areas are identical.</p><p>Additionally, Rawpy reads the RAF&rsquo;s <code>raw pattern</code> incorrectly, whereas the <code>raw pattern</code> in the DNG is correct.</p><p>One caution: LibRaw provides a <code>halfsize</code> option that merges RGGB into a single pixel to output a half-resolution three-channel image. In theory, this should not be used on X-Trans sensors, but LibRaw still allows it, seemingly running the same pipeline as Bayer sensors and producing incorrect results.</p><h3 id=nikon>Nikon<a hidden class=anchor aria-hidden=true href=#nikon>#</a></h3><p>Nikon is the simplest case. The test model is a Z6 outputting NEF files. Reading directly with LibRaw or after conversion to DNG yields images of (6064, 4040); there is no extra padding, and the content is identical.</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>The easiest workflow is usually to convert to DNG: the files get smaller, the format is unified, and non-image regions are cropped away for easier processing. If you want to preserve the original format, metadata, and cropped-out regions, read the original RAW with LibRaw or Rawpy. Across most tests, the overlapping image areas have identical pixel values.</p><p>Avoid using non-Adobe tools to convert RAW to DNG. Since dcraw is no longer maintained, migrate to LibRaw/Rawpy.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jackchou.top/en/tags/colour/>Colour</a></li><li><a href=https://jackchou.top/en/tags/isp/>ISP</a></li></ul><nav class=paginav><a class=prev href=https://jackchou.top/en/posts/colour-checker-for-jpg/><span class=title>¬´ Prev</span><br><span>Not Just Colour Difference: Evaluate Image with Colour Chart</span>
</a><a class=next href=https://jackchou.top/en/posts/display-reflectance/><span class=title>Next ¬ª</span><br><span>Reflectance: Another Path to Readability in Bright Environments</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://jackchou.top/en/>JacksBlog</a></span> ¬∑
my friends&rsquo; websites: <a href=https://zhxwu.com/>zhxwu.com</a>, <a href=https://ylqian.com/>ylqian.com</a> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script defer crossorigin=anonymous src=/js/site.min.a576538c52b362e170acc02d53f5ce6045117863354954a8f91f10c7217d94ab.js integrity="sha256-pXZTjFKzYuFwrMAtU/XOYEUReGM1SVSo+R8QxyF9lKs="></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>