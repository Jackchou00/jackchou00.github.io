<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Principles of Colour Reproduction in Digital Images Notes: Fundamentals of Colorimetry | üè°JacksBlog</title>
<meta name="keywords" content="Colour, PCRDI">
<meta name="description" content="Notes for Principles of Color Reproduction in Digital Images, Ep.2">
<meta name="author" content="">
<link rel="canonical" href="https://jackchou.top/en/posts/pcrdi02/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bb4e9ae2e440bccf3cb7d24276f41ff835376bf2c78193c51417a098608382c4.css" integrity="sha256-u06a4uRAvM88t9JCdvQf&#43;DU3a/LHgZPFFBegmGCDgsQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jackchou.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jackchou.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jackchou.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jackchou.top/apple-touch-icon.png">
<link rel="mask-icon" href="https://jackchou.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://jackchou.top/posts/pcrdi02/">
<link rel="alternate" hreflang="en" href="https://jackchou.top/en/posts/pcrdi02/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Noto+Sans+SC:wght@100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">


<style>
#domain-migration-notice {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 12px 20px;
  text-align: center;
  z-index: 1000;
  font-size: 14px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: none;
}

#domain-migration-notice.show {
  display: block;
}

#domain-migration-notice .notice-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
}

#domain-migration-notice .notice-text {
  flex: 1;
  text-align: center;
}

#domain-migration-notice .close-btn {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  transition: background-color 0.3s;
}

#domain-migration-notice .close-btn:hover {
  background: rgba(255,255,255,0.3);
}

#domain-migration-notice a {
  color: #ffeb3b;
  text-decoration: underline;
}

body.notice-shown {
  padding-top: 60px;
}

@media (max-width: 768px) {
  #domain-migration-notice {
    padding: 10px 15px;
    font-size: 13px;
  }
  
  #domain-migration-notice .notice-content {
    flex-direction: column;
    gap: 8px;
  }
  
  body.notice-shown {
    padding-top: 80px;
  }
}
</style>

<script>
(function() {
  
  const expiryDate = new Date('2025-10-31');
  const now = new Date();
  
  if (now > expiryDate) {
    return; 
  }
  
  
  if (localStorage.getItem('domain-migration-dismissed') === 'true') {
    return;
  }
  
  
  const noticeHTML = `
    <div id="domain-migration-notice">
      <div class="notice-content">
        <div class="notice-text">
          <span class="zh-notice" style="display: none;">
            üëã ÂÜçËßÅÔºåjackchou00.icu    üöÄ Êñ∞ÁöÑÊóÖÈÄîÔºå‰ªé <a href="https://jackchou.top">jackchou.top</a> Ëµ∑Á®ã
          </span>
          <span class="en-notice" style="display: none;">
            üëã Goodbye, jackchou00.icu    üöÄ A new chapter will begin at <a href="https://jackchou.top">jackchou.top</a>
          </span>
        </div>
        <button class="close-btn" onclick="dismissNotice()">‚úï</button>
      </div>
    </div>
  `;
  
  
  document.addEventListener('DOMContentLoaded', function() {
    
    document.body.insertAdjacentHTML('afterbegin', noticeHTML);
    
    
    const isEnglish = document.documentElement.lang === 'en' || window.location.pathname.startsWith('/en/');
    const zhNotice = document.querySelector('.zh-notice');
    const enNotice = document.querySelector('.en-notice');
    
    if (isEnglish && enNotice) {
      enNotice.style.display = 'inline';
    } else if (zhNotice) {
      zhNotice.style.display = 'inline';
    }
    
    
    const notice = document.getElementById('domain-migration-notice');
    if (notice) {
      notice.classList.add('show');
      document.body.classList.add('notice-shown');
    }
  });
  
  
  window.dismissNotice = function() {
    const notice = document.getElementById('domain-migration-notice');
    if (notice) {
      notice.style.display = 'none';
      document.body.classList.remove('notice-shown');
      localStorage.setItem('domain-migration-dismissed', 'true');
    }
  };
})();
</script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4dc1311d77d6840123f21aa2f8a31c84";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><meta property="og:url" content="https://jackchou.top/en/posts/pcrdi02/">
  <meta property="og:site_name" content="üè°JacksBlog">
  <meta property="og:title" content="Principles of Colour Reproduction in Digital Images Notes: Fundamentals of Colorimetry">
  <meta property="og:description" content="Notes for Principles of Color Reproduction in Digital Images, Ep.2">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-25T00:00:00+08:00">
    <meta property="article:modified_time" content="2025-01-25T00:00:00+08:00">
    <meta property="article:tag" content="Colour">
    <meta property="article:tag" content="PCRDI">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Principles of Colour Reproduction in Digital Images Notes: Fundamentals of Colorimetry">
<meta name="twitter:description" content="Notes for Principles of Color Reproduction in Digital Images, Ep.2">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts üå≥",
      "item": "https://jackchou.top/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Principles of Colour Reproduction in Digital Images Notes: Fundamentals of Colorimetry",
      "item": "https://jackchou.top/en/posts/pcrdi02/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Principles of Colour Reproduction in Digital Images Notes: Fundamentals of Colorimetry",
  "name": "Principles of Colour Reproduction in Digital Images Notes: Fundamentals of Colorimetry",
  "description": "Notes for Principles of Color Reproduction in Digital Images, Ep.2",
  "keywords": [
    "Colour", "PCRDI"
  ],
  "articleBody": "We have already covered the quantitative description of light, including its Spectral Power Distribution and radiometric quantities. This chapter deals with the quantitative description of colour, known as Colorimetry.\nColour Mixing Mixing: Colour mixing is divided into additive and subtractive mixing. When lights of various colours are shone onto a white sheet of paper, they can mix to produce white light. In contrast, when various pigments are applied to a white sheet of paper, the result is black. Additive mixing is more commonly used in experiments, and it is the principle behind displays.\nMatching: One half of an area is illuminated by one light, and the other half by another. If an observer cannot perceive a dividing line in the middle, meaning the two sides ‚Äúlook‚Äù the same, then the two lights (or their corresponding colours) are a match for that observer.\nColour and Light: Humans perceive light, which produces the sensation of colour. Light is a physical quantity, whereas colour is a psychophysical quantity. One light corresponds to one colour, but one colour does not necessarily correspond to only one light.\nThe Quantity of Colour: Colour is produced by light. Just as the quantity of light can be measured by radiometric quantities, the quantity of colour can be measured relatively by radiometric quantities. For instance, if the radiometric quantity is doubled, the ‚Äúquantity of colour‚Äù is also doubled.\nUnder certain conditions, the human eye‚Äôs perception of colour mixing is linear, encompassing the following aspects:\nIf two lights match, they have the same colour. If the quantities of both colours are changed by the same factor, they will still match. If colour A matches colour B, and colour C matches colour D, then a mixture of colours A and C will also match a mixture of colours B and D. If a mixture of colours A and B matches colour C, and a mixture of colours X and Y matches colour B, then a mixture of colours A, X, and Y will match colour C. In simple terms, colour mixing is like the addition you learned in primary school, because colour mixing is essentially the superposition of light spectra, and radiometric quantities are naturally additive. Furthermore, once a match is made, it does not change with environmental variations. For example, changing the brightness or warmth of the background will not disrupt the match between the two lights on the white paper.\nAlthough colour mixing is linear, it does not mean that the perception of colour is linear. Taking brightness as an example, while 1 unit of light added to 1 unit of light can match 2 units of light, it does not mean that a person‚Äôs perception of brightness increases linearly.\nCIE 1931 RGB Colour Matching Functions CIE: The International Commission on Illumination (Commission Internationale de l‚ÄôEclairage) is an international organisation dedicated to the study of light, colour, and illumination. The CIE has established a series of standards in the field of colour science. The previously mentioned spectral luminous efficiency function $V(\\lambda)$ is one of the standards set by the CIE. Its presence can be seen in all aspects of colour science.\nFor detailed information on CIE 1931 RGB and colour matching functions, please see this excellent blog post: https://yuhaozhu.com/blog/cmf.html\n$$ C(\\lambda) = \\bar{r}(\\lambda) R + \\bar{g}(\\lambda) G + \\bar{b}(\\lambda) B $$ For some wavelengths of monochromatic light, a match cannot be achieved. In such cases, one of the primaries must be moved to the monochromatic light‚Äôs side, and its coefficient becomes negative.\nThis process yields a set of curves known as the Colour Matching Functions (CMFs), which are $\\bar{r}(\\lambda)$, $\\bar{g}(\\lambda)$, and $\\bar{b}(\\lambda)$. In the 1920s, W.D. Wright and J. Guild, among others, obtained data through experiments. In 1931, the CIE compiled and recommended a standard set of colour matching functions, known as the CIE 1931 RGB colour matching functions.\nHere, we are omitting countless details, such as whether the energy of the monochromatic light at each wavelength was the same in the experiments; the fact that the wavelengths of the primaries used by Wright and Guild were not identical, nor were they the same as the primaries ultimately recommended by the CIE, and how this data was converted; whether they were normalised, how they were normalised, and what the final units of the colour matching functions are. Although textbooks are often verbose, they choose to gloss over these points. I recommend reading the article at this link.\nThe function values here are called tristimulus values. The CIE 1931 RGB colour matching functions only contain data for a 2¬∞ field of view, which corresponds to the fovea of the human eye, the area where cone cells are most densely distributed. Wright‚Äôs experiment involved 10 observers, and Guild‚Äôs involved 7. This means that the experimental data from these 17 individuals laid the foundation for nearly a century of colour science, while also leaving behind potential issues and problems.\n$$ r = \\frac{R}{R+G+B} $$ The same applies to g and b. The resulting values, where $r + g + b = 1$, are called chromaticity coordinates.\nIn the 1931 RGB system, when the luminance ratio of the three primaries is $1:4.5907:0.0601$, they can be mixed to produce a colour that matches equal-energy white light. Furthermore, when the matching functions are added together in this proportion, they yield the previously mentioned spectral luminous efficiency function $V(\\lambda)$, meaning luminance can be calculated from the tristimulus values. This was likely the reference for the normalisation of the CIE 1931 RGB system.\nEqual-energy white light: Light in which all wavelengths have equal radiant energy. In the 1931 RGB system, the tristimulus values for equal-energy white light are (0.33, 0.33, 0.33).\nThe CIE 1931 XYZ Colorimetric System The CIE 1931 RGB colour matching functions were based on real primaries, which resulted in some negative values in calculations. This posed computational difficulties at the time. To solve this problem, the CIE recommended the CIE 1931 XYZ standard colorimetric system, which used imaginary primaries to not only ensure all tristimulus values were positive but also achieve other objectives.\nThe XYZ colorimetric system is derived from the RGB colorimetric system through a linear transformation:\n$$ \\begin{bmatrix} X \\\\ Y \\\\ Z \\end{bmatrix} = \\begin{bmatrix} 2.7689 \u0026 1.7517 \u0026 1.1302 \\\\ 1.0000 \u0026 4.5907 \u0026 0.0601 \\\\ 0.0000 \u0026 0.0565 \u0026 5.5943 \\end{bmatrix} \\begin{bmatrix} R \\\\ G \\\\ B \\end{bmatrix} $$The transformation matrix satisfies the following conditions:\nIn the RGB system, the spectral locus from 560-700 nm forms a straight line because short-wavelength light is no longer needed for matching in this range. It was desired for two of the new primaries to lie on this line. It was desired to use the Y value in the XYZ system to represent luminance, with X and Z having zero contribution to luminance. Therefore, X and Z should lie on the alychne (the line of zero luminance), i.e., $r + 4.5907g + 0.0601b = 0$. The final edge is a line tangent to the spectral locus at 503 nm. The equal-energy white point remains at (0.33, 0.33, 0.33). The resulting XYZ colour matching functions are all positive and represent the luminances of three imaginary primaries. Among them, $Y(\\lambda)$ is identical to the spectral luminous efficiency function $V(\\lambda)$. The Y value is equivalent to luminance.\nNormalising XYZ gives the chromaticity coordinates and luminance, $xyY$, which can be plotted to create the CIE 1931 xy chromaticity diagram.\nThe colouring on the chromaticity diagram is for aesthetic purposes; the points on the diagram contain only chromaticity information and no luminance information, which is why colours like grey are not shown. Because the chromaticity diagram is still linear, selecting two points on it allows for the mixing of their corresponding coloured lights to produce any colour on the line segment between them. If three points are chosen, colours within the resulting triangle can be mixed, which is also how the range of colours a display can show (its gamut) is represented. The diagram also shows that no set of three primaries can mix to produce all the colours perceptible to the human eye.\nUniform Colour Spaces Colour Space: A mathematical representation of colour, using a few quantities (usually three) to specify a colour. For example, CIE 1931 XYZ is a colour space that uses the three tristimulus values X, Y, and Z to represent colours. Colour spaces can be linear, meaning colours can be added and subtracted, or non-linear. Different colour spaces serve different functions. In colour science, colours need to be processed in the appropriate colour space.\nThe Non-linearity of Luminance Firstly, the human eye‚Äôs perception of brightness is non-linear. In an experiment similar to the matching experiment, subjects observe two colours with the same chromaticity coordinates but different luminances. Their luminances are $L$ and $L+\\Delta L$. When the difference in luminance is very small, a visual match can still be achieved. When the luminance difference exceeds a certain threshold, a difference can be perceived. This luminance difference is called the ‚ÄúJust Noticeable Difference‚Äù (JND). The JND varies at different luminance levels, so the luminance Y in the XYZ colour space is non-uniform. A change in Y from 10 to 20 is perceived differently from a change from 90 to 100. To address this, two new concepts were introduced: Lightness and Brightness. Brightness is the perception of absolute luminance, i.e., how ‚Äúbright‚Äù a light is. Lightness is the relative value of brightness, representing the perceived ‚Äúbrightness‚Äù of an object relative to a perfect reflecting diffuser under the same illumination. For example, a sheet of white paper has a lightness of 90 (relative to 100) whether it is outdoors on a sunny day or indoors, but its brightness will change. The goal of lightness is that for a given change in lightness value, the perceived change in brightness is the same.\nBased on different experimental results, many lightness models have been proposed. The simplest lightness model is just a power function, such as Hunter‚Äôs lightness $L_H = Y ^ {0.5}$. Although lightness models vary in complexity, their basic shape is similar: in dark areas, the eye‚Äôs perception of brightness increases more rapidly, while in bright areas, it slows down. For example, the grey perceived by the human eye as being halfway between black and white has a reflectance of about 18-25%, not 50%.\nThe Non-linearity of Chromaticity Similarly, if two points that are close together are chosen on the CIE 1931 xy chromaticity diagram, a subject may not be able to distinguish their colours, i.e., the difference is less than one JND. MacAdam conducted experiments where subjects performed additive colour mixing from a single colour in different directions (i.e., deviating in different directions), recording the new position when a difference could be discerned. The experiments found that these new positions could be well-fitted by an ellipse, hence they are called MacAdam ellipses.\nThe MacAdam ellipses plotted on the CIE 1931 xy chromaticity diagram show that the chromaticity uniformity of this colour space is rather poor, as the ellipses vary in size and orientation. Many attempts have been made to improve chromaticity uniformity. For instance, noticing that the ellipses in the upper part of the chromaticity diagram are rather elongated, one might vertically compress the diagram. However, simple transformations have not yielded satisfactory results. Notable attempts include the CIE 1960 UCS and 1976 UCS. By applying simple transformations to xy to convert them into new colour coordinates uv or u‚Äôv‚Äô, some improvement in uniformity was achieved. Here, UCS stands for Uniform-Chromaticity-Scale.\nUniform Colour Spaces A lightness model (or uniform lightness scale) and a uniform chromaticity scale together form a three-dimensional colour space, known as a Uniform Colour Space. A well-known example is CIE 1976 \\(L^*a^*b^* \\), or CIELAB. It is composed of \\(L^*\\), which represents lightness, and \\(a^*b^*\\), which represent chromaticity on red-green and yellow-blue axes. Note that the asterisk is part of the symbol, and notations like Lab should be avoided to prevent confusion with symbols from other colour spaces.\nCIELAB is a relative colour space, requiring a ‚Äúreference white point‚Äù to be defined first. This is the tristimulus values $X_n, Y_n, Z_n$ of a perfect reflecting diffuser under the illuminant.\n$$ L^* = 116 f(\\frac{Y}{Y_n}) - 16 $$$$ a^* = 500 [f(\\frac{X}{X_n}) - f(\\frac{Y}{Y_n})] $$$$ b^* = 200 [f(\\frac{Y}{Y_n}) - f(\\frac{Z}{Z_n})] $$Where,\n$$ f(t) = \\begin{cases} t^{1/3} \u0026 t \u003e (24/116)^{3} \\\\ (841 / 108)t + 16/116 \u0026 t \\leq (24/116)^{3} \\end{cases} $$CIELAB remains the most widely used uniform colour space today.\nColour Difference In industrial applications, we need to quantitatively measure the difference between colours. For example, in quality control, a batch of products is considered acceptable if the surface colour difference is below a certain threshold.\nIf a uniform colour space exists, the best way to measure colour difference would be to simply take the Euclidean distance between two colours in that space. Applied to the CIELAB space, this gives:\n$$ \\Delta E_{ab}=\\sqrt{(\\Delta L^*)^2+(\\Delta a^*)^2+(\\Delta b^*)^2} $$Unfortunately, the uniformity of CIELAB is not strong enough to directly apply such a distance formula to measure colour difference accurately. In the following decades, various patches were developed to calculate colour difference in the CIELAB space. The most famous of these is the CIE 2000 colour difference formula, or CIEDE2000, proposed by M.R. Luo, with the symbol $\\Delta E_{00}$. If you frequently follow digital or display technology, you have likely seen DE2000 used as a common tool for measuring display colour accuracy.\nAlthough CIEDE2000 is computationally complex, it is currently one of the best-performing formulas across all datasets and is the latest colour difference formula recommended by the CIE.\nThe Munsell Colour System Munsell was an American artist who, as early as 1905 (before the CIE 1931 XYZ system), developed a Colour Order System by summarising the experience of his predecessors and combining it with his own perspective as a painter. A colour order system is a system of colours formed by classifying and arranging various colour samples in a specific order, starting from visual perception.\nFrom the time Newton separated white light into the colours of the rainbow, we have been able to classify colours into red, orange, yellow, green, blue, indigo, and violet. This is, in fact, a classification of colours by their Hue.\nMunsell arranged colours into a three-dimensional space, called a colour solid, according to three dimensions: Value (Lightness), Hue, and Chroma. The colour chips within this solid are considered to be perceptually equidistant in all three dimensions. It is one of the most widely used colour systems today.\nBecause the Munsell Colour System is considered perceptually uniform, one can measure the tristimulus values of its colours and transform them into later uniform colour spaces. By observing whether the distribution of these points in the uniform colour space remains relatively ‚Äúuniform‚Äù, the performance of the uniform colour space can be evaluated to some extent.\nM. Li and M. R. Luo, ‚ÄòSimple color appearance model (sCAM) based on simple uniform color space (sUCS)‚Äô, Opt. Express, vol. 32, no. 3, p. 3100, Jan. 2024, doi: 10.1364/OE.510196.\n",
  "wordCount" : "2501",
  "inLanguage": "en",
  "datePublished": "2025-01-25T00:00:00+08:00",
  "dateModified": "2025-01-25T00:00:00+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jackchou.top/en/posts/pcrdi02/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "üè°JacksBlog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jackchou.top/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jackchou.top/en/" accesskey="h" title="üè°JacksBlog (Alt + H)">üè°JacksBlog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://jackchou.top/" title="‰∏≠Êñá"
                            aria-label="‰∏≠Êñá">Zh-Cn</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jackchou.top/en/posts/" title="Posts üå≥">
                    <span>Posts üå≥</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/photos/" title="Photos üì∑">
                    <span>Photos üì∑</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/tags/" title="Tags üè∑Ô∏è">
                    <span>Tags üè∑Ô∏è</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/about/" title="About üòº">
                    <span>About üòº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Principles of Colour Reproduction in Digital Images Notes: Fundamentals of Colorimetry
    </h1>
    <div class="post-meta"><span title='2025-01-25 00:00:00 +0800 +0800'>2025.01.25</span>&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://jackchou.top/posts/pcrdi02/">Zh-Cn</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#colour-mixing" aria-label="Colour Mixing">Colour Mixing</a></li>
                <li>
                    <a href="#cie-1931-rgb-colour-matching-functions" aria-label="CIE 1931 RGB Colour Matching Functions">CIE 1931 RGB Colour Matching Functions</a></li>
                <li>
                    <a href="#the-cie-1931-xyz-colorimetric-system" aria-label="The CIE 1931 XYZ Colorimetric System">The CIE 1931 XYZ Colorimetric System</a></li>
                <li>
                    <a href="#uniform-colour-spaces" aria-label="Uniform Colour Spaces">Uniform Colour Spaces</a><ul>
                        
                <li>
                    <a href="#the-non-linearity-of-luminance" aria-label="The Non-linearity of Luminance">The Non-linearity of Luminance</a></li>
                <li>
                    <a href="#the-non-linearity-of-chromaticity" aria-label="The Non-linearity of Chromaticity">The Non-linearity of Chromaticity</a></li>
                <li>
                    <a href="#uniform-colour-spaces-1" aria-label="Uniform Colour Spaces">Uniform Colour Spaces</a></li></ul>
                </li>
                <li>
                    <a href="#colour-difference" aria-label="Colour Difference">Colour Difference</a></li>
                <li>
                    <a href="#the-munsell-colour-system" aria-label="The Munsell Colour System">The Munsell Colour System</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>We have already covered the quantitative description of light, including its Spectral Power Distribution and radiometric quantities. This chapter deals with the quantitative description of colour, known as Colorimetry.</p>
<h2 id="colour-mixing">Colour Mixing<a hidden class="anchor" aria-hidden="true" href="#colour-mixing">#</a></h2>
<p>Mixing: Colour mixing is divided into additive and subtractive mixing. When lights of various colours are shone onto a white sheet of paper, they can mix to produce white light. In contrast, when various pigments are applied to a white sheet of paper, the result is black. Additive mixing is more commonly used in experiments, and it is the principle behind displays.</p>
<p>Matching: One half of an area is illuminated by one light, and the other half by another. If an observer cannot perceive a dividing line in the middle, meaning the two sides &ldquo;look&rdquo; the same, then the two lights (or their corresponding colours) are a match for that observer.</p>
<p>Colour and Light: Humans perceive light, which produces the sensation of colour. Light is a physical quantity, whereas colour is a psychophysical quantity. One light corresponds to one colour, but one colour does not necessarily correspond to only one light.</p>
<p>The Quantity of Colour: Colour is produced by light. Just as the quantity of light can be measured by radiometric quantities, the quantity of colour can be measured relatively by radiometric quantities. For instance, if the radiometric quantity is doubled, the &ldquo;quantity of colour&rdquo; is also doubled.</p>
<p>Under certain conditions, the human eye&rsquo;s perception of colour mixing is linear, encompassing the following aspects:</p>
<ol>
<li>If two lights match, they have the same colour. If the quantities of both colours are changed by the same factor, they will still match.</li>
<li>If colour A matches colour B, and colour C matches colour D, then a mixture of colours A and C will also match a mixture of colours B and D.</li>
<li>If a mixture of colours A and B matches colour C, and a mixture of colours X and Y matches colour B, then a mixture of colours A, X, and Y will match colour C.</li>
</ol>
<p>In simple terms, colour mixing is like the addition you learned in primary school, because colour mixing is essentially the superposition of light spectra, and radiometric quantities are naturally additive. Furthermore, once a match is made, it does not change with environmental variations. For example, changing the brightness or warmth of the background will not disrupt the match between the two lights on the white paper.</p>
<p>Although colour mixing is linear, it does not mean that the perception of colour is linear. Taking brightness as an example, while 1 unit of light added to 1 unit of light can match 2 units of light, it does not mean that a person&rsquo;s perception of brightness increases linearly.</p>
<h2 id="cie-1931-rgb-colour-matching-functions">CIE 1931 RGB Colour Matching Functions<a hidden class="anchor" aria-hidden="true" href="#cie-1931-rgb-colour-matching-functions">#</a></h2>
<blockquote>
<p>CIE: The International Commission on Illumination (Commission Internationale de l&rsquo;Eclairage) is an international organisation dedicated to the study of light, colour, and illumination. The CIE has established a series of standards in the field of colour science. The previously mentioned spectral luminous efficiency function $V(\lambda)$ is one of the standards set by the CIE. Its presence can be seen in all aspects of colour science.</p>
</blockquote>
<blockquote>
<p>For detailed information on CIE 1931 RGB and colour matching functions, please see this excellent blog post: <a href="https://yuhaozhu.com/blog/cmf.html">https://yuhaozhu.com/blog/cmf.html</a></p>
</blockquote>
$$ C(\lambda) = \bar{r}(\lambda) R + \bar{g}(\lambda) G + \bar{b}(\lambda) B $$<p>
For some wavelengths of monochromatic light, a match cannot be achieved. In such cases, one of the primaries must be moved to the monochromatic light&rsquo;s side, and its coefficient becomes negative.</p>
<p>This process yields a set of curves known as the Colour Matching Functions (CMFs), which are $\bar{r}(\lambda)$, $\bar{g}(\lambda)$, and $\bar{b}(\lambda)$. In the 1920s, W.D. Wright and J. Guild, among others, obtained data through experiments. In 1931, the CIE compiled and recommended a standard set of colour matching functions, known as the CIE 1931 RGB colour matching functions.</p>
<p>Here, we are omitting countless details, such as whether the energy of the monochromatic light at each wavelength was the same in the experiments; the fact that the wavelengths of the primaries used by Wright and Guild were not identical, nor were they the same as the primaries ultimately recommended by the CIE, and how this data was converted; whether they were normalised, how they were normalised, and what the final units of the colour matching functions are. Although textbooks are often verbose, they choose to gloss over these points. I recommend reading the article at this <a href="https://yuhaozhu.com/blog/cmf.html">link</a>.</p>
<p><img alt="CIE 1931 RGB colour matching functions" loading="lazy" src="https://img.jackchou.top/jack-img/2025/01/c32644afd71c9f9761fed38acf28696b.svg"></p>
<p>The function values here are called tristimulus values. The CIE 1931 RGB colour matching functions only contain data for a 2¬∞ field of view, which corresponds to the fovea of the human eye, the area where cone cells are most densely distributed. Wright&rsquo;s experiment involved 10 observers, and Guild&rsquo;s involved 7. This means that the experimental data from these 17 individuals laid the foundation for nearly a century of colour science, while also leaving behind potential issues and problems.</p>
$$ r = \frac{R}{R+G+B} $$<p>
The same applies to g and b. The resulting values, where $r + g + b = 1$, are called chromaticity coordinates.</p>
<p>In the 1931 RGB system, when the luminance ratio of the three primaries is $1:4.5907:0.0601$, they can be mixed to produce a colour that matches equal-energy white light. Furthermore, when the matching functions are added together in this proportion, they yield the previously mentioned spectral luminous efficiency function $V(\lambda)$, meaning luminance can be calculated from the tristimulus values. <em>This was likely the reference for the normalisation of the CIE 1931 RGB system.</em></p>
<p>Equal-energy white light: Light in which all wavelengths have equal radiant energy. In the 1931 RGB system, the tristimulus values for equal-energy white light are (0.33, 0.33, 0.33).</p>
<p><img alt="CIE 1931 RGB chromaticity diagram" loading="lazy" src="https://img.jackchou.top/jack-img/2025/01/c683b54de761240aec24d7bbba89a5e2.svg"></p>
<h2 id="the-cie-1931-xyz-colorimetric-system">The CIE 1931 XYZ Colorimetric System<a hidden class="anchor" aria-hidden="true" href="#the-cie-1931-xyz-colorimetric-system">#</a></h2>
<p>The CIE 1931 RGB colour matching functions were based on real primaries, which resulted in some negative values in calculations. This posed computational difficulties at the time. To solve this problem, the CIE recommended the CIE 1931 XYZ standard colorimetric system, which used imaginary primaries to not only ensure all tristimulus values were positive but also achieve other objectives.</p>
<p>The XYZ colorimetric system is derived from the RGB colorimetric system through a linear transformation:</p>
$$ \begin{bmatrix} X \\ Y \\ Z \end{bmatrix} = \begin{bmatrix} 2.7689 & 1.7517 & 1.1302 \\ 1.0000 & 4.5907 & 0.0601 \\ 0.0000 & 0.0565 & 5.5943 \end{bmatrix} \begin{bmatrix} R \\ G \\ B \end{bmatrix} $$<p>The transformation matrix satisfies the following conditions:</p>
<ol>
<li>In the RGB system, the spectral locus from 560-700 nm forms a straight line because short-wavelength light is no longer needed for matching in this range. It was desired for two of the new primaries to lie on this line.</li>
<li>It was desired to use the Y value in the XYZ system to represent luminance, with X and Z having zero contribution to luminance. Therefore, X and Z should lie on the alychne (the line of zero luminance), i.e., $r + 4.5907g + 0.0601b = 0$.</li>
<li>The final edge is a line tangent to the spectral locus at 503 nm.</li>
<li>The equal-energy white point remains at (0.33, 0.33, 0.33).</li>
</ol>
<p>The resulting XYZ colour matching functions are all positive and represent the luminances of three imaginary primaries. Among them, $Y(\lambda)$ is identical to the spectral luminous efficiency function $V(\lambda)$. The Y value is equivalent to luminance.</p>
<p><img alt="CIE 1931 XYZ colour matching functions" loading="lazy" src="https://img.jackchou.top/jack-img/2025/01/cbdd7652af46d0c9c1f25092d9e8dbee.svg"></p>
<p>Normalising XYZ gives the chromaticity coordinates and luminance, $xyY$, which can be plotted to create the CIE 1931 xy chromaticity diagram.</p>
<p><img alt="CIE 1931 xy chromaticity diagram" loading="lazy" src="https://img.jackchou.top/jack-img/2025/01/ca832743c8df5d386cb71fbb737ed51e.svg"></p>
<p>The colouring on the chromaticity diagram is for aesthetic purposes; the points on the diagram contain only chromaticity information and no luminance information, which is why colours like grey are not shown. Because the chromaticity diagram is still linear, selecting two points on it allows for the mixing of their corresponding coloured lights to produce any colour on the line segment between them. If three points are chosen, colours within the resulting triangle can be mixed, which is also how the range of colours a display can show (its gamut) is represented. The diagram also shows that no set of three primaries can mix to produce all the colours perceptible to the human eye.</p>
<h2 id="uniform-colour-spaces">Uniform Colour Spaces<a hidden class="anchor" aria-hidden="true" href="#uniform-colour-spaces">#</a></h2>
<p>Colour Space: A mathematical representation of colour, using a few quantities (usually three) to specify a colour. For example, CIE 1931 XYZ is a colour space that uses the three tristimulus values X, Y, and Z to represent colours. Colour spaces can be linear, meaning colours can be added and subtracted, or non-linear. Different colour spaces serve different functions. In colour science, colours need to be processed in the appropriate colour space.</p>
<h3 id="the-non-linearity-of-luminance">The Non-linearity of Luminance<a hidden class="anchor" aria-hidden="true" href="#the-non-linearity-of-luminance">#</a></h3>
<p>Firstly, the human eye&rsquo;s perception of brightness is non-linear. In an experiment similar to the matching experiment, subjects observe two colours with the same chromaticity coordinates but different luminances. Their luminances are $L$ and $L+\Delta L$. When the difference in luminance is very small, a visual match can still be achieved. When the luminance difference exceeds a certain threshold, a difference can be perceived. This luminance difference is called the &ldquo;Just Noticeable Difference&rdquo; (JND). The JND varies at different luminance levels, so the luminance Y in the XYZ colour space is non-uniform. A change in Y from 10 to 20 is perceived differently from a change from 90 to 100. To address this, two new concepts were introduced: Lightness and Brightness. Brightness is the perception of absolute luminance, i.e., how &ldquo;bright&rdquo; a light is. Lightness is the relative value of brightness, representing the perceived &ldquo;brightness&rdquo; of an object relative to a perfect reflecting diffuser under the same illumination. For example, a sheet of white paper has a lightness of 90 (relative to 100) whether it is outdoors on a sunny day or indoors, but its brightness will change. The goal of lightness is that for a given change in lightness value, the perceived change in brightness is the same.</p>
<p>Based on different experimental results, many lightness models have been proposed. The simplest lightness model is just a power function, such as Hunter&rsquo;s lightness $L_H = Y ^ {0.5}$. Although lightness models vary in complexity, their basic shape is similar: in dark areas, the eye&rsquo;s perception of brightness increases more rapidly, while in bright areas, it slows down. For example, the grey perceived by the human eye as being halfway between black and white has a reflectance of about 18-25%, not 50%.</p>
<h3 id="the-non-linearity-of-chromaticity">The Non-linearity of Chromaticity<a hidden class="anchor" aria-hidden="true" href="#the-non-linearity-of-chromaticity">#</a></h3>
<p>Similarly, if two points that are close together are chosen on the CIE 1931 xy chromaticity diagram, a subject may not be able to distinguish their colours, i.e., the difference is less than one JND. MacAdam conducted experiments where subjects performed additive colour mixing from a single colour in different directions (i.e., deviating in different directions), recording the new position when a difference could be discerned. The experiments found that these new positions could be well-fitted by an ellipse, hence they are called MacAdam ellipses.</p>
<p><img alt="MacAdam ellipses on the CIE 1931 xy chromaticity diagram" loading="lazy" src="https://img.jackchou.top/jack-img/2025/01/9cba2e71b70b189bca5c9adf70a96b61.svg"></p>
<p>The MacAdam ellipses plotted on the CIE 1931 xy chromaticity diagram show that the chromaticity uniformity of this colour space is rather poor, as the ellipses vary in size and orientation. Many attempts have been made to improve chromaticity uniformity. For instance, noticing that the ellipses in the upper part of the chromaticity diagram are rather elongated, one might vertically compress the diagram. However, simple transformations have not yielded satisfactory results. Notable attempts include the CIE 1960 UCS and 1976 UCS. By applying simple transformations to xy to convert them into new colour coordinates uv or u&rsquo;v&rsquo;, some improvement in uniformity was achieved. Here, UCS stands for Uniform-Chromaticity-Scale.</p>
<h3 id="uniform-colour-spaces-1">Uniform Colour Spaces<a hidden class="anchor" aria-hidden="true" href="#uniform-colour-spaces-1">#</a></h3>
<p>A lightness model (or uniform lightness scale) and a uniform chromaticity scale together form a three-dimensional colour space, known as a Uniform Colour Space. A well-known example is CIE 1976 \(L^*a^*b^* \), or CIELAB. It is composed of \(L^*\), which represents lightness, and \(a^*b^*\), which represent chromaticity on red-green and yellow-blue axes. Note that the asterisk is part of the symbol, and notations like Lab should be avoided to prevent confusion with symbols from other colour spaces.</p>
<p>CIELAB is a relative colour space, requiring a &ldquo;reference white point&rdquo; to be defined first. This is the tristimulus values $X_n, Y_n, Z_n$ of a perfect reflecting diffuser under the illuminant.</p>
$$ L^* = 116 f(\frac{Y}{Y_n}) - 16 $$$$ a^* = 500 [f(\frac{X}{X_n}) - f(\frac{Y}{Y_n})] $$$$ b^* = 200 [f(\frac{Y}{Y_n}) - f(\frac{Z}{Z_n})] $$<p>Where,</p>
$$ f(t) = \begin{cases} t^{1/3} & t > (24/116)^{3} \\ (841 / 108)t + 16/116 & t \leq (24/116)^{3} \end{cases} $$<p>CIELAB remains the most widely used uniform colour space today.</p>
<h2 id="colour-difference">Colour Difference<a hidden class="anchor" aria-hidden="true" href="#colour-difference">#</a></h2>
<p>In industrial applications, we need to quantitatively measure the difference between colours. For example, in quality control, a batch of products is considered acceptable if the surface colour difference is below a certain threshold.</p>
<p>If a uniform colour space exists, the best way to measure colour difference would be to simply take the Euclidean distance between two colours in that space. Applied to the CIELAB space, this gives:</p>
$$ \Delta E_{ab}=\sqrt{(\Delta L^*)^2+(\Delta a^*)^2+(\Delta b^*)^2} $$<p>Unfortunately, the uniformity of CIELAB is not strong enough to directly apply such a distance formula to measure colour difference accurately. In the following decades, various patches were developed to calculate colour difference in the CIELAB space. The most famous of these is the CIE 2000 colour difference formula, or CIEDE2000, proposed by M.R. Luo, with the symbol $\Delta E_{00}$. If you frequently follow digital or display technology, you have likely seen DE2000 used as a common tool for measuring display colour accuracy.</p>
<p>Although CIEDE2000 is computationally complex, it is currently one of the best-performing formulas across all datasets and is the latest colour difference formula recommended by the CIE.</p>
<h2 id="the-munsell-colour-system">The Munsell Colour System<a hidden class="anchor" aria-hidden="true" href="#the-munsell-colour-system">#</a></h2>
<p>Munsell was an American <strong>artist</strong> who, as early as 1905 (before the CIE 1931 XYZ system), developed a Colour Order System by summarising the experience of his predecessors and combining it with his own perspective as a painter. A colour order system is a system of colours formed by classifying and arranging various colour samples in a specific order, starting from visual perception.</p>
<p>From the time Newton separated white light into the colours of the rainbow, we have been able to classify colours into red, orange, yellow, green, blue, indigo, and violet. This is, in fact, a classification of colours by their Hue.</p>
<p>Munsell arranged colours into a three-dimensional space, called a colour solid, according to three dimensions: Value (Lightness), Hue, and Chroma. The colour chips within this solid are considered to be perceptually equidistant in all three dimensions. It is one of the most widely used colour systems today.</p>
<p>Because the Munsell Colour System is considered perceptually uniform, one can measure the tristimulus values of its colours and transform them into later uniform colour spaces. By observing whether the distribution of these points in the uniform colour space remains relatively &ldquo;uniform&rdquo;, the performance of the uniform colour space can be evaluated to some extent.</p>
<p><img alt="Munsell colour solid" loading="lazy" src="https://img.jackchou.top/jack-img/2025/01/b1f62144c8d7e015eb1444fd3b4a0e43.avif"></p>
<blockquote>
<p>M. Li and M. R. Luo, ‚ÄòSimple color appearance model (sCAM) based on simple uniform color space (sUCS)‚Äô, Opt. Express, vol. 32, no. 3, p. 3100, Jan. 2024, doi: 10.1364/OE.510196.</p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jackchou.top/en/tags/colour/">Colour</a></li>
      <li><a href="https://jackchou.top/en/tags/pcrdi/">PCRDI</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jackchou.top/en/">üè°JacksBlog</a></span> ¬∑ 
        my friends&rsquo; websites: <a href="https://zhxwu.com/">zhxwu.com</a>, <a href="https://ylqian.com/">ylqian.com</a> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div style="text-align: center; margin-top: 10px; margin-bottom: 20px; width: 100%; display: flex; justify-content: center;">
    <img src="https://visitor-badge.laobi.icu/badge?page_id=jacksblog" alt="visitors" style="max-width: 120px; height: auto;" />
</div>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
