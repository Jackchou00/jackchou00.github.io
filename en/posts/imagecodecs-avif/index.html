<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>A New Python AVIF Encoding Option: ImageCodecs | üè°JacksBlog</title>
<meta name="keywords" content="AVIF image encoding, Python image processing, Python AVIF encoding libraries, libavif Python bindings, pillow-avif-plugin parameters, pillow-heif AVIF support, ImageCodecs AVIF encoding, NumPy array image output">
<meta name="description" content="Encode high bit-depth NumPy arrays directly to AVIF in Python using ImageCodecs and libavif, with HDR, lossless, and quality/speed options.">
<meta name="author" content="Jack">
<link rel="canonical" href="https://jackchou.top/en/posts/imagecodecs-avif/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e30af01949f15b214a659db89950589c44040efcfcdeec2087ad8629d77c216e.css" integrity="sha256-4wrwGUnxWyFKZZ24mVBYnEQEDvz83uwgh62GKdd8IW4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jackchou.top/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jackchou.top/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jackchou.top/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jackchou.top/apple-touch-icon.png">
<link rel="mask-icon" href="https://jackchou.top/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://jackchou.top/posts/imagecodecs-avif/">
<link rel="alternate" hreflang="en" href="https://jackchou.top/en/posts/imagecodecs-avif/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
        c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
        t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
        y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "u9z1afks70");
</script><meta property="og:url" content="https://jackchou.top/en/posts/imagecodecs-avif/">
  <meta property="og:site_name" content="üè°JacksBlog">
  <meta property="og:title" content="A New Python AVIF Encoding Option: ImageCodecs">
  <meta property="og:description" content="Encode high bit-depth NumPy arrays directly to AVIF in Python using ImageCodecs and libavif, with HDR, lossless, and quality/speed options.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-10T23:00:00+08:00">
    <meta property="article:modified_time" content="2025-11-10T23:49:03+08:00">
    <meta property="article:tag" content="Display">
    <meta property="article:tag" content="HDR">
    <meta property="article:tag" content="AVIF">
    <meta property="article:tag" content="Image">
      <meta property="og:image" content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp">
<meta name="twitter:title" content="A New Python AVIF Encoding Option: ImageCodecs">
<meta name="twitter:description" content="Encode high bit-depth NumPy arrays directly to AVIF in Python using ImageCodecs and libavif, with HDR, lossless, and quality/speed options.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts üå≥",
      "item": "https://jackchou.top/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "A New Python AVIF Encoding Option: ImageCodecs",
      "item": "https://jackchou.top/en/posts/imagecodecs-avif/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "A New Python AVIF Encoding Option: ImageCodecs",
  "name": "A New Python AVIF Encoding Option: ImageCodecs",
  "description": "Encode high bit-depth NumPy arrays directly to AVIF in Python using ImageCodecs and libavif, with HDR, lossless, and quality/speed options.",
  "keywords": [
    "AVIF image encoding", "Python image processing", "Python AVIF encoding libraries", "libavif Python bindings", "pillow-avif-plugin parameters", "pillow-heif AVIF support", "ImageCodecs AVIF encoding", "NumPy array image output"
  ],
  "articleBody": "Background Requirements Images processed and generated in Python are usually stored as NumPy arrays, and writing these arrays out to files is the final step of the pipeline. In the past, the most common approach was using PIL to encode them as JPEG. As needs around HDR, high bit-depth, and higher compression ratios have grown, I started looking for ways to encode numerical data directly into AVIF images.\nlibavif and libheif Almost all related libraries are Python bindings for libavif or libheif. In practice, you can absolutely export a JPEG or a high bit-depth TIFF first, then call a compiled libavif directly for encoding, passing in all parameters (quality, speed, colour configuration). If all you need is image compression, there‚Äôs really no need to route back through Python.\nSo the core requirement is actually to find a good Python binding for libavif that supports passing various parameters, and if the API is elegant, even better.\nLimited options AVIF encoding in Python has seen some progress. PIL added official AVIF support in version 11.3.0, but both reading and writing are limited to 8-bit, and there is no interface for passing parameters. The following two plugins can read/write high bit-depth images and accept parameters.\nBefore PIL 11.3.0, the way to use PIL for AVIF encoding was the pillow-avif-plugin plugin, where advanced parameters could be passed in via keyword arguments.\nAnother choice with PIL is pillow-heif, which is a binding for libheif. After version 1.0.0 it removed AVIF support, with the developer‚Äôs reasoning being that PIL already has native AVIF support. The last version with AVIF support is 0.22.0, and advanced parameters also need to be passed via keyword arguments.\nImageIO and OpenImageIO both provide read/write support for various image formats, but they don‚Äôt seem to support high bit-depth and advanced parameters (or more accurately, their APIs are a bit complex and I haven‚Äôt fully figured them out yet, but it‚Äôs either unsupported or a hassle).\nA new choice: ImageCodecs ImageCodecs is another library that provides read/write support for various image formats, using libavif as the backend for AVIF.\nIts strengths lie in its very clean API design. It previously did not support passing colour space parameters, but support was added in the 2025.11.11 release. (If you need something, feel free to ‚Äúreach out‚Äù reasonably in the Issue.)\nfrom imagecodecs import avif_version, avif_encode, AVIF import numpy as np print(AVIF.available) print(avif_version()) array = np.ones((100, 100), dtype=np.uint16) * 65535 # 10-bit, BT.2020 with BT.2100 PQ transfer function # The numeric values for primaries/transfer are defined in H.273 encoded: bytes = avif_encode( array, bitspersample=10, primaries=9, transfer=16 ) with open(\"output.avif\", \"wb\") as f: f.write(encoded) All of its image formats follow similar function naming. You just need to check availability and version, then call encode or decode.\nWatch out for the flashbang (sorry, might be too late).\nPeak RGB and white in BT.2020 primaries with the BT.2100 PQ transfer function, 10-bit, encoded with ImageCodecs.\n",
  "wordCount" : "486",
  "inLanguage": "en",
  "image": "https://img.jackchou.top/jack-img/2025/08/81bb602c03f9704ee42e292468396187.webp","datePublished": "2025-11-10T23:00:00+08:00",
  "dateModified": "2025-11-10T23:49:03+08:00",
  "author":{
    "@type": "Person",
    "name": "Jack"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jackchou.top/en/posts/imagecodecs-avif/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "üè°JacksBlog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jackchou.top/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jackchou.top/en/" accesskey="h" title="üè°JacksBlog (Alt + H)">üè°JacksBlog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://jackchou.top/" title="‰∏≠Êñá"
                            aria-label="‰∏≠Êñá">‰∏≠Êñá</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jackchou.top/en/posts/" title="Posts üå≥">
                    <span>Posts üå≥</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/photos/" title="Photos üì∑">
                    <span>Photos üì∑</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/tags/" title="Tags üè∑Ô∏è">
                    <span>Tags üè∑Ô∏è</span>
                </a>
            </li>
            <li>
                <a href="https://jackchou.top/en/about/" title="About üòº">
                    <span>About üòº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      A New Python AVIF Encoding Option: ImageCodecs
    </h1>
    
    <div class="post-meta"><span title='2025-11-10 23:00:00 +0800 +0800'>2025.11.10</span>&nbsp;¬∑&nbsp;Jack&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://jackchou.top/posts/imagecodecs-avif/">‰∏≠Êñá</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#background" aria-label="Background">Background</a><ul>
                        
                <li>
                    <a href="#requirements" aria-label="Requirements">Requirements</a></li>
                <li>
                    <a href="#libavif-and-libheif" aria-label="libavif and libheif">libavif and libheif</a></li></ul>
                </li>
                <li>
                    <a href="#limited-options" aria-label="Limited options">Limited options</a></li>
                <li>
                    <a href="#a-new-choice-imagecodecs" aria-label="A new choice: ImageCodecs">A new choice: ImageCodecs</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="background">Background<a hidden class="anchor" aria-hidden="true" href="#background">#</a></h2>
<h3 id="requirements">Requirements<a hidden class="anchor" aria-hidden="true" href="#requirements">#</a></h3>
<p>Images processed and generated in Python are usually stored as NumPy arrays, and writing these arrays out to files is the final step of the pipeline. In the past, the most common approach was using PIL to encode them as JPEG. As needs around HDR, high bit-depth, and higher compression ratios have grown, I started looking for ways to encode numerical data directly into AVIF images.</p>
<h3 id="libavif-and-libheif">libavif and libheif<a hidden class="anchor" aria-hidden="true" href="#libavif-and-libheif">#</a></h3>
<p>Almost all related libraries are Python bindings for libavif or libheif. In practice, you can absolutely export a JPEG or a high bit-depth TIFF first, then call a compiled libavif directly for encoding, passing in all parameters (quality, speed, colour configuration). If all you need is image compression, there‚Äôs really no need to route back through Python.</p>
<p>So the core requirement is actually to find a good Python binding for libavif that supports passing various parameters, and if the API is elegant, even better.</p>
<h2 id="limited-options">Limited options<a hidden class="anchor" aria-hidden="true" href="#limited-options">#</a></h2>
<p>AVIF encoding in Python has seen some progress. PIL added official AVIF support in version 11.3.0, but both reading and writing are limited to 8-bit, and there is no interface for passing parameters. The following two plugins can read/write high bit-depth images and accept parameters.</p>
<p>Before PIL 11.3.0, the way to use PIL for AVIF encoding was the <code>pillow-avif-plugin</code> plugin, where advanced parameters could be passed in via keyword arguments.</p>
<p>Another choice with PIL is <code>pillow-heif</code>, which is a binding for libheif. After version 1.0.0 it removed AVIF support, with the developer‚Äôs reasoning being that PIL already has native AVIF support. The last version with AVIF support is 0.22.0, and advanced parameters also need to be passed via keyword arguments.</p>
<p>ImageIO and OpenImageIO both provide read/write support for various image formats, but they don‚Äôt seem to support high bit-depth and advanced parameters (or more accurately, their APIs are a bit complex and I haven‚Äôt fully figured them out yet, but it‚Äôs either unsupported or a hassle).</p>
<h2 id="a-new-choice-imagecodecs">A new choice: ImageCodecs<a hidden class="anchor" aria-hidden="true" href="#a-new-choice-imagecodecs">#</a></h2>
<p><a href="https://github.com/cgohlke/imagecodecs">ImageCodecs</a> is another library that provides read/write support for various image formats, using libavif as the backend for AVIF.</p>
<p>Its strengths lie in its very clean API design. It previously did not support passing colour space parameters, but support was added in the 2025.11.11 release. (If you need something, feel free to ‚Äúreach out‚Äù reasonably in the <a href="https://github.com/cgohlke/imagecodecs/issues/131">Issue</a>.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> imagecodecs <span style="color:#f92672">import</span> avif_version, avif_encode, AVIF
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(AVIF<span style="color:#f92672">.</span>available)
</span></span><span style="display:flex;"><span>print(avif_version())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>array <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>ones((<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>), dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>uint16) <span style="color:#f92672">*</span> <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 10-bit, BT.2020 with BT.2100 PQ transfer function</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The numeric values for primaries/transfer are defined in H.273</span>
</span></span><span style="display:flex;"><span>encoded: bytes <span style="color:#f92672">=</span> avif_encode(
</span></span><span style="display:flex;"><span>    array, bitspersample<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, primaries<span style="color:#f92672">=</span><span style="color:#ae81ff">9</span>, transfer<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;output.avif&#34;</span>, <span style="color:#e6db74">&#34;wb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    f<span style="color:#f92672">.</span>write(encoded)
</span></span></code></pre></div><p>All of its image formats follow similar function naming. You just need to check availability and version, then call encode or decode.</p>
<p>Watch out for the flashbang (sorry, might be too late).</p>
<p><img alt="bt2020 pq test by imagecodecs" loading="lazy" src="https://img.jackchou.top/jack-img/2025/11/7e50ba86eb4697f2055b7b5b0763cca9.avif"></p>
<p>Peak RGB and white in BT.2020 primaries with the BT.2100 PQ transfer function, 10-bit, encoded with ImageCodecs.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jackchou.top/en/tags/display/">Display</a></li>
      <li><a href="https://jackchou.top/en/tags/hdr/">HDR</a></li>
      <li><a href="https://jackchou.top/en/tags/avif/">AVIF</a></li>
      <li><a href="https://jackchou.top/en/tags/image/">Image</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jackchou.top/en/">üè°JacksBlog</a></span> ¬∑ 
        my friends&rsquo; websites: <a href="https://zhxwu.com/">zhxwu.com</a>, <a href="https://ylqian.com/">ylqian.com</a> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div style="text-align: center; margin-top: 10px; margin-bottom: 20px; width: 100%; display: flex; justify-content: center;">
    <img src="https://visitor-badge.laobi.icu/badge?page_id=jacksblog" alt="visitors" style="max-width: 120px; height: auto;" />
</div><script>
(() => {
    const images = document.querySelectorAll('.post-content img');
    if (!images.length) return;

    const overlay = document.createElement('div');
    overlay.className = 'image-lightbox';
    overlay.innerHTML = '<img class="image-lightbox__img" alt="" />';

    const overlayImg = overlay.querySelector('img');
    const closeOverlay = () => {
        overlay.classList.remove('is-visible');
        overlayImg.removeAttribute('src');
        document.body.style.removeProperty('overflow');
    };

    overlay.addEventListener('click', closeOverlay);
    document.addEventListener('keyup', (event) => {
        if (event.key === 'Escape' && overlay.classList.contains('is-visible')) {
            closeOverlay();
        }
    });

    document.body.appendChild(overlay);

    images.forEach((img) => {
        img.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();

            const source = img.dataset.zoomSrc || img.currentSrc || img.src;
            const cleanSrc = source.split('#')[0];

            overlayImg.src = cleanSrc;
            overlayImg.alt = img.alt || '';

            overlay.classList.add('is-visible');
            document.body.style.setProperty('overflow', 'hidden');
        });
    });
})();
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
